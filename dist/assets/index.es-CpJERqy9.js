import{g as Kn}from"./index-4bUGY1Ln.js";var Fn={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(h,f){var o=h[0],u=h[1],l=h[2],_=h[3];o+=(u&l|~u&_)+f[0]-680876936|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[1]-389564586|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[2]+606105819|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[3]-1044525330|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[4]-176418897|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[5]+1200080426|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[6]-1473231341|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[7]-45705983|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[8]+1770035416|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[9]-1958414417|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[10]-42063|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[11]-1990404162|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[12]+1804603682|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[13]-40341101|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[14]-1502002290|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[15]+1236535329|0,u=(u<<22|u>>>10)+l|0,o+=(u&_|l&~_)+f[1]-165796510|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[6]-1069501632|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[11]+643717713|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[0]-373897302|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[5]-701558691|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[10]+38016083|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[15]-660478335|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[4]-405537848|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[9]+568446438|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[14]-1019803690|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[3]-187363961|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[8]+1163531501|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[13]-1444681467|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[2]-51403784|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[7]+1735328473|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[12]-1926607734|0,u=(u<<20|u>>>12)+l|0,o+=(u^l^_)+f[5]-378558|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[8]-2022574463|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[11]+1839030562|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[14]-35309556|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[1]-1530992060|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[4]+1272893353|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[7]-155497632|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[10]-1094730640|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[13]+681279174|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[0]-358537222|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[3]-722521979|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[6]+76029189|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[9]-640364487|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[12]-421815835|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[15]+530742520|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[2]-995338651|0,u=(u<<23|u>>>9)+l|0,o+=(l^(u|~_))+f[0]-198630844|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[7]+1126891415|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[14]-1416354905|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[5]-57434055|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[12]+1700485571|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[3]-1894986606|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[10]-1051523|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[1]-2054922799|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[8]+1873313359|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[15]-30611744|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[6]-1560198380|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[13]+1309151649|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[4]-145523070|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[11]-1120210379|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[2]+718787259|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[9]-343485551|0,u=(u<<21|u>>>11)+l|0,h[0]=o+h[0]|0,h[1]=u+h[1]|0,h[2]=l+h[2]|0,h[3]=_+h[3]|0}function s(h){var f=[],o;for(o=0;o<64;o+=4)f[o>>2]=h.charCodeAt(o)+(h.charCodeAt(o+1)<<8)+(h.charCodeAt(o+2)<<16)+(h.charCodeAt(o+3)<<24);return f}function a(h){var f=[],o;for(o=0;o<64;o+=4)f[o>>2]=h[o]+(h[o+1]<<8)+(h[o+2]<<16)+(h[o+3]<<24);return f}function d(h){var f=h.length,o=[1732584193,-271733879,-1732584194,271733878],u,l,_,D,T,k;for(u=64;u<=f;u+=64)i(o,s(h.substring(u-64,u)));for(h=h.substring(u-64),l=h.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)_[u>>2]|=h.charCodeAt(u)<<(u%4<<3);if(_[u>>2]|=128<<(u%4<<3),u>55)for(i(o,_),u=0;u<16;u+=1)_[u]=0;return D=f*8,D=D.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(D[2],16),k=parseInt(D[1],16)||0,_[14]=T,_[15]=k,i(o,_),o}function v(h){var f=h.length,o=[1732584193,-271733879,-1732584194,271733878],u,l,_,D,T,k;for(u=64;u<=f;u+=64)i(o,a(h.subarray(u-64,u)));for(h=u-64<f?h.subarray(u-64):new Uint8Array(0),l=h.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)_[u>>2]|=h[u]<<(u%4<<3);if(_[u>>2]|=128<<(u%4<<3),u>55)for(i(o,_),u=0;u<16;u+=1)_[u]=0;return D=f*8,D=D.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(D[2],16),k=parseInt(D[1],16)||0,_[14]=T,_[15]=k,i(o,_),o}function y(h){var f="",o;for(o=0;o<4;o+=1)f+=r[h>>o*8+4&15]+r[h>>o*8&15];return f}function m(h){var f;for(f=0;f<h.length;f+=1)h[f]=y(h[f]);return h.join("")}m(d("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function h(f,o){return f=f|0||0,f<0?Math.max(f+o,0):Math.min(f,o)}ArrayBuffer.prototype.slice=function(f,o){var u=this.byteLength,l=h(f,u),_=u,D,T,k,$;return o!==n&&(_=h(o,u)),l>_?new ArrayBuffer(0):(D=_-l,T=new ArrayBuffer(D),k=new Uint8Array(T),$=new Uint8Array(this,l,D),k.set($),T)}}();function c(h){return/[\u0080-\uFFFF]/.test(h)&&(h=unescape(encodeURIComponent(h))),h}function g(h,f){var o=h.length,u=new ArrayBuffer(o),l=new Uint8Array(u),_;for(_=0;_<o;_+=1)l[_]=h.charCodeAt(_);return f?l:u}function w(h){return String.fromCharCode.apply(null,new Uint8Array(h))}function S(h,f,o){var u=new Uint8Array(h.byteLength+f.byteLength);return u.set(new Uint8Array(h)),u.set(new Uint8Array(f),h.byteLength),u}function C(h){var f=[],o=h.length,u;for(u=0;u<o-1;u+=2)f.push(parseInt(h.substr(u,2),16));return String.fromCharCode.apply(String,f)}function p(){this.reset()}return p.prototype.append=function(h){return this.appendBinary(c(h)),this},p.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var f=this._buff.length,o;for(o=64;o<=f;o+=64)i(this._hash,s(this._buff.substring(o-64,o)));return this._buff=this._buff.substring(o-64),this},p.prototype.end=function(h){var f=this._buff,o=f.length,u,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_;for(u=0;u<o;u+=1)l[u>>2]|=f.charCodeAt(u)<<(u%4<<3);return this._finish(l,o),_=m(this._hash),h&&(_=C(_)),this.reset(),_},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(h){return this._buff=h.buff,this._length=h.length,this._hash=h.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(h,f){var o=f,u,l,_;if(h[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,h),o=0;o<16;o+=1)h[o]=0;u=this._length*8,u=u.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(u[2],16),_=parseInt(u[1],16)||0,h[14]=l,h[15]=_,i(this._hash,h)},p.hash=function(h,f){return p.hashBinary(c(h),f)},p.hashBinary=function(h,f){var o=d(h),u=m(o);return f?C(u):u},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(h){var f=S(this._buff.buffer,h),o=f.length,u;for(this._length+=h.byteLength,u=64;u<=o;u+=64)i(this._hash,a(f.subarray(u-64,u)));return this._buff=u-64<o?new Uint8Array(f.buffer.slice(u-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(h){var f=this._buff,o=f.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,_;for(l=0;l<o;l+=1)u[l>>2]|=f[l]<<(l%4<<3);return this._finish(u,o),_=m(this._hash),h&&(_=C(_)),this.reset(),_},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var h=p.prototype.getState.call(this);return h.buff=w(h.buff),h},p.ArrayBuffer.prototype.setState=function(h){return h.buff=g(h.buff,!0),p.prototype.setState.call(this,h)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(h,f){var o=v(new Uint8Array(h)),u=m(o);return f?C(u):u},p})})(Fn);var Rr=Fn.exports;const Et=Kn(Rr);var Xe,Lr=new Uint8Array(16);function Br(){if(!Xe&&(Xe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Xe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xe(Lr)}const Ir=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function jr(t){return typeof t=="string"&&Ir.test(t)}var ce=[];for(var vt=0;vt<256;++vt)ce.push((vt+256).toString(16).substr(1));function $r(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(ce[t[e+0]]+ce[t[e+1]]+ce[t[e+2]]+ce[t[e+3]]+"-"+ce[t[e+4]]+ce[t[e+5]]+"-"+ce[t[e+6]]+ce[t[e+7]]+"-"+ce[t[e+8]]+ce[t[e+9]]+"-"+ce[t[e+10]]+ce[t[e+11]]+ce[t[e+12]]+ce[t[e+13]]+ce[t[e+14]]+ce[t[e+15]]).toLowerCase();if(!jr(n))throw TypeError("Stringified UUID is invalid");return n}function zt(t,e,n){t=t||{};var r=t.random||(t.rng||Br)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return $r(r)}var ot={};ot.stringify=function(e){var n=[];n.push({obj:e});for(var r="",i,s,a,d,v,y,m,c,g,w,S;i=n.pop();)if(s=i.obj,a=i.prefix||"",d=i.val||"",r+=a,d)r+=d;else if(typeof s!="object")r+=typeof s>"u"?null:JSON.stringify(s);else if(s===null)r+="null";else if(Array.isArray(s)){for(n.push({val:"]"}),v=s.length-1;v>=0;v--)y=v===0?"":",",n.push({obj:s[v],prefix:y});n.push({val:"["})}else{m=[];for(c in s)s.hasOwnProperty(c)&&m.push(c);for(n.push({val:"}"}),v=m.length-1;v>=0;v--)g=m[v],w=s[g],S=v>0?",":"",S+=JSON.stringify(g)+":",n.push({obj:w,prefix:S});n.push({val:"{"})}return r};function je(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(t);else if(s===e.length-2){var a=e.pop();i[a]=t}else e.push(t)}ot.parse=function(t){for(var e=[],n=[],r=0,i,s,a,d,v,y,m,c,g;;){if(i=t[r++],i==="}"||i==="]"||typeof i>"u"){if(e.length===1)return e.pop();je(e.pop(),e,n);continue}switch(i){case" ":case"	":case`
`:case":":case",":break;case"n":r+=3,je(null,e,n);break;case"t":r+=3,je(!0,e,n);break;case"f":r+=4,je(!1,e,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(s="",r--;;)if(a=t[r++],/[\d\.\-e\+]/.test(a))s+=a;else{r--;break}je(parseFloat(s),e,n);break;case'"':for(d="",v=void 0,y=0;m=t[r++],m!=='"'||v==="\\"&&y%2===1;)d+=m,v=m,v==="\\"?y++:y=0;je(JSON.parse('"'+d+'"'),e,n);break;case"[":c={element:[],index:e.length},e.push(c.element),n.push(c);break;case"{":g={element:{},index:e.length},e.push(g.element),n.push(g);break;default:throw new Error("unexpectedly reached end of input: "+i)}}};var Qt={exports:{}},Ne=typeof Reflect=="object"?Reflect:null,cn=Ne&&typeof Ne.apply=="function"?Ne.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Ve;Ne&&typeof Ne.ownKeys=="function"?Ve=Ne.ownKeys:Object.getOwnPropertySymbols?Ve=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ve=function(e){return Object.getOwnPropertyNames(e)};function Nr(t){console&&console.warn&&console.warn(t)}var Mn=Number.isNaN||function(e){return e!==e};function V(){V.init.call(this)}Qt.exports=V;Qt.exports.once=Ur;V.EventEmitter=V;V.prototype._events=void 0;V.prototype._eventsCount=0;V.prototype._maxListeners=void 0;var fn=10;function ut(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(V,"defaultMaxListeners",{enumerable:!0,get:function(){return fn},set:function(t){if(typeof t!="number"||t<0||Mn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");fn=t}});V.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};V.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Mn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Un(t){return t._maxListeners===void 0?V.defaultMaxListeners:t._maxListeners}V.prototype.getMaxListeners=function(){return Un(this)};V.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var d=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw d.context=a,d}var v=s[e];if(v===void 0)return!1;if(typeof v=="function")cn(v,this,n);else for(var y=v.length,m=Wn(v,y),r=0;r<y;++r)cn(m[r],this,n);return!0};function Gn(t,e,n,r){var i,s,a;if(ut(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),a=s[e]),a===void 0)a=s[e]=n,++t._eventsCount;else if(typeof a=="function"?a=s[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=Un(t),i>0&&a.length>i&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=a.length,Nr(d)}return t}V.prototype.addListener=function(e,n){return Gn(this,e,n,!1)};V.prototype.on=V.prototype.addListener;V.prototype.prependListener=function(e,n){return Gn(this,e,n,!0)};function Kr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Jn(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Kr.bind(r);return i.listener=n,r.wrapFn=i,i}V.prototype.once=function(e,n){return ut(n),this.on(e,Jn(this,e,n)),this};V.prototype.prependOnceListener=function(e,n){return ut(n),this.prependListener(e,Jn(this,e,n)),this};V.prototype.removeListener=function(e,n){var r,i,s,a,d;if(ut(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){d=r[a].listener,s=a;break}if(s<0)return this;s===0?r.shift():Fr(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,d||n)}return this};V.prototype.off=V.prototype.removeListener;V.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function zn(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Mr(i):Wn(i,i.length)}V.prototype.listeners=function(e){return zn(this,e,!0)};V.prototype.rawListeners=function(e){return zn(this,e,!1)};V.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Qn.call(t,e)};V.prototype.listenerCount=Qn;function Qn(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}V.prototype.eventNames=function(){return this._eventsCount>0?Ve(this._events):[]};function Wn(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Fr(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Mr(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Ur(t,e){return new Promise(function(n,r){function i(a){t.removeListener(e,s),r(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}Hn(t,e,s,{once:!0}),e!=="error"&&Gr(t,i,{once:!0})})}function Gr(t,e,n){typeof t.on=="function"&&Hn(t,"error",e,n)}function Hn(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Jr=Qt.exports;const xe=Kn(Jr);function zr(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer||typeof Blob<"u"&&t instanceof Blob}function Qr(t){return t instanceof ArrayBuffer?t.slice(0):t.slice(0,t.size,t.type)}var Xn=Function.prototype.toString,Wr=Xn.call(Object);function Hr(t){var e=Object.getPrototypeOf(t);if(e===null)return!0;var n=e.constructor;return typeof n=="function"&&n instanceof n&&Xn.call(n)==Wr}function oe(t){var e,n,r;if(!t||typeof t!="object")return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=oe(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(zr(t))return Qr(t);if(!Hr(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=oe(t[n]);typeof i<"u"&&(e[n]=i)}return e}function Yn(t){var e=!1;return function(...n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)}}function Zn(t){return function(...e){e=oe(e);var n=this,r=typeof e[e.length-1]=="function"?e.pop():!1,i=new Promise(function(s,a){var d;try{var v=Yn(function(y,m){y?a(y):s(m)});e.push(v),d=t.apply(n,e),d&&typeof d.then=="function"&&s(d)}catch(y){a(y)}});return r&&i.then(function(s){r(null,s)},r),i}}function Xr(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(a,d){var v=["api",t.name,e];v=v.concat(a?["error",a]:["success",d]),t.constructor.emit("debug",v),s(a,d)}}}function ne(t,e){return Zn(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return Xr(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(i,s){r.taskqueue.addTask(function(a){a?s(a):i(r[t].apply(r,n))})})})}function We(t,e){for(var n={},r=0,i=e.length;r<i;r++){var s=e[r];s in t&&(n[s]=t[s])}return n}var Yr=6;function ln(t){return t}function Zr(t){return[{ok:t}]}function Vn(t,e,n){var r=e.docs,i=new Map;r.forEach(function(C){i.has(C.id)?i.get(C.id).push(C):i.set(C.id,[C])});var s=i.size,a=0,d=new Array(s);function v(){var C=[];d.forEach(function(p){p.docs.forEach(function(h){C.push({id:p.id,docs:[h]})})}),n(null,{results:C})}function y(){++a===s&&v()}function m(C,p,h){d[C]={id:p,docs:h},y()}var c=[];i.forEach(function(C,p){c.push(p)});var g=0;function w(){if(!(g>=c.length)){var C=Math.min(g+Yr,c.length),p=c.slice(g,C);S(p,g),g+=p.length}}function S(C,p){C.forEach(function(h,f){var o=p+f,u=i.get(h),l=We(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(D){return D.rev}),l.open_revs=l.open_revs.filter(ln);var _=ln;l.open_revs.length===0&&(delete l.open_revs,_=Zr),["revs","attachments","binary","ajax","latest"].forEach(function(D){D in e&&(l[D]=e[D])}),t.get(h,l,function(D,T){var k;D?k=[{error:D}]:k=_(T),m(o,h,k),w()})})}w()}var kt;try{localStorage.setItem("_pouch_check_localstorage",1),kt=!!localStorage.getItem("_pouch_check_localstorage")}catch{kt=!1}function nt(){return kt}const Oe=typeof queueMicrotask=="function"?queueMicrotask:function(e){Promise.resolve().then(e)};class Vr extends xe{constructor(){super(),this._listeners={},nt()&&addEventListener("storage",e=>{this.emit(e.key)})}addListener(e,n,r,i){if(this._listeners[n])return;var s=!1,a=this;function d(){if(!a._listeners[n])return;if(s){s="waiting";return}s=!0;var v=We(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function y(){s=!1}r.changes(v).on("change",function(m){m.seq>i.since&&!i.cancelled&&(i.since=m.seq,i.onChange(m))}).on("complete",function(){s==="waiting"&&Oe(d),s=!1}).on("error",y)}this._listeners[n]=d,this.on(e,d)}removeListener(e,n){n in this._listeners&&(super.removeListener(e,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(e){nt()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")}notify(e){this.emit(e),this.notifyLocalWindows(e)}}function ge(t){if(typeof console<"u"&&typeof console[t]=="function"){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function ei(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e=e+1,e>n&&(t=n>>1,e=n);var r=Math.random(),i=e-t;return~~(i*r+t)}function ti(t){var e=0;return t||(e=2e3),ei(t,e)}function Dt(t,e){ge("info","The above "+t+" is totally normal. "+e)}class ee extends Error{constructor(e,n,r){super(),this.status=e,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new ee(401,"unauthorized","Name or password is incorrect.");var ni=new ee(400,"bad_request","Missing JSON list of 'docs'"),ve=new ee(404,"not_found","missing"),Me=new ee(409,"conflict","Document update conflict"),er=new ee(400,"bad_request","_id field must contain a string"),ri=new ee(412,"missing_id","_id is required for puts"),ii=new ee(400,"bad_request","Only reserved document ids may start with underscore.");new ee(412,"precondition_failed","Database not open");var Wt=new ee(500,"unknown_error","Database encountered an unknown error"),tr=new ee(500,"badarg","Some query argument is invalid");new ee(400,"invalid_request","Request was invalid");var si=new ee(400,"query_parse_error","Some query parameter is invalid"),dn=new ee(500,"doc_validation","Bad special document member"),ct=new ee(400,"bad_request","Something wrong with the request"),_t=new ee(400,"bad_request","Document must be a JSON object");new ee(404,"not_found","Database not found");var Ht=new ee(500,"indexed_db_went_bad","unknown");new ee(500,"web_sql_went_bad","unknown");new ee(500,"levelDB_went_went_bad","unknown");new ee(403,"forbidden","Forbidden by design doc validate_doc_update function");var et=new ee(400,"bad_request","Invalid rev format");new ee(412,"file_exists","The database could not be created, the file already exists.");var ai=new ee(412,"missing_stub","A pre-existing attachment stub wasn't found");new ee(413,"invalid_url","Provided URL is invalid");function U(t,e){function n(r){for(var i=Object.getOwnPropertyNames(t),s=0,a=i.length;s<a;s++)typeof t[i[s]]!="function"&&(this[i[s]]=t[i[s]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=ee.prototype,new n(e)}function Ue(t){if(typeof t!="object"){var e=t;t=Wt,t.data=e}return"error"in t&&t.error==="conflict"&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=new Error().stack),t}function oi(t,e,n){try{return!t(e,n)}catch(i){var r="Filter function threw: "+i.toString();return U(ct,r)}}function Xt(t){var e={},n=t.filter&&typeof t.filter=="function";return e.query=t.query_params,function(i){i.doc||(i.doc={});var s=n&&oi(t.filter,i.doc,e);if(typeof s=="object")return s;if(s)return!1;if(!t.include_docs)delete i.doc;else if(!t.attachments)for(var a in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,a)&&(i.doc._attachments[a].stub=!0);return!0}}function nr(t){var e;if(t?typeof t!="string"?e=U(er):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=U(ii)):e=U(ri),e)throw e}function Ce(t){return typeof t._remote=="boolean"?t._remote:typeof t.type=="function"?(ge("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),t.type()==="http"):!1}function ui(t,e){return"listenerCount"in t?t.listenerCount(e):xe.listenerCount(t,e)}function Tt(t){if(!t)return null;var e=t.split("/");return e.length===2?e:e.length===1?[t,t]:null}function hn(t){var e=Tt(t);return e?e.join("/"):null}var vn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],_n="queryKey",ci=/(?:^|&)([^&=]*)=?([^&]*)/g,fi=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function rr(t){for(var e=fi.exec(t),n={},r=14;r--;){var i=vn[r],s=e[r]||"",a=["user","password"].indexOf(i)!==-1;n[i]=a?decodeURIComponent(s):s}return n[_n]={},n[vn[12]].replace(ci,function(d,v,y){v&&(n[_n][v]=y)}),n}function Yt(t,e){var n=[],r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function rt(t,e,n){return t.get(e).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,s=n(r);return s?(s._id=e,s._rev=i,li(t,s,n)):{updated:!1,rev:i}})}function li(t,e,n){return t.put(e).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return rt(t,e._id,n)})}var Zt=function(t){return atob(t)},He=function(t){return btoa(t)};function Vt(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if(s.name!=="TypeError")throw s;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function di(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function en(t,e){return Vt([di(t)],{type:e})}function tn(t,e){return en(Zt(t),e)}function hi(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}function ir(t,e){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var s=i.target.result||"";if(r)return e(s);e(hi(s))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function sr(t,e){ir(t,function(n){e(n)})}function nn(t,e){sr(t,function(n){e(He(n))})}function vi(t,e){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);e(i)},n.readAsArrayBuffer(t)}var _i=self.setImmediate||self.setTimeout,gi=32768;function yi(t){return He(t)}function pi(t,e,n,r,i){(n>0||r<e.size)&&(e=e.slice(n,r)),vi(e,function(s){t.append(s),i()})}function mi(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function rn(t,e){var n=typeof t=="string",r=n?t.length:t.size,i=Math.min(gi,r),s=Math.ceil(r/i),a=0,d=n?new Et:new Et.ArrayBuffer,v=n?mi:pi;function y(){_i(c)}function m(){var g=d.end(!0),w=yi(g);e(w),d.destroy()}function c(){var g=a*i,w=g+i;a++,a<s?v(d,t,g,w,y):v(d,t,g,w,m)}c()}function ar(t){return Et.hash(t)}function or(t,e){if(!e)return zt().replace(/-/g,"").toLowerCase();var n=Object.assign({},t);return delete n._rev_tree,ar(JSON.stringify(n))}var ft=zt;function Le(t){for(var e,n,r,i=t.rev_tree.slice(),s;s=i.pop();){var a=s.ids,d=a[2],v=s.pos;if(d.length){for(var y=0,m=d.length;y<m;y++)i.push({pos:v+1,ids:d[y]});continue}var c=!!a[1].deleted,g=a[0];(!e||(r!==c?r:n!==v?n<v:e<g))&&(e=g,n=v,r=c)}return n+"-"+e}function Be(t,e){for(var n=t.slice(),r;r=n.pop();)for(var i=r.pos,s=r.ids,a=s[2],d=e(a.length===0,i,s[0],r.ctx,s[1]),v=0,y=a.length;v<y;v++)n.push({pos:i+1,ids:a[v],ctx:d})}function wi(t,e){return t.pos-e.pos}function sn(t){var e=[];Be(t,function(i,s,a,d,v){i&&e.push({rev:s+"-"+a,pos:s,opts:v})}),e.sort(wi).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function an(t){for(var e=Le(t),n=sn(t.rev_tree),r=[],i=0,s=n.length;i<s;i++){var a=n[i];a.rev!==e&&!a.opts.deleted&&r.push(a.rev)}return r}function bi(t){var e=[];return Be(t.rev_tree,function(n,r,i,s,a){a.status==="available"&&!n&&(e.push(r+"-"+i),a.status="missing")}),e}function Si(t,e){let n=[];const r=t.slice();let i;for(;i=r.pop();){const{pos:s,ids:a}=i,d=`${s}-${a[0]}`,v=a[2];if(n.push(d),d===e){if(v.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(v.length===0||v.length>1)&&(n=[]);for(let y=0,m=v.length;y<m;y++)r.push({pos:s+1,ids:v[y]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function ur(t){for(var e=[],n=t.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,a=s[0],d=s[1],v=s[2],y=v.length===0,m=r.history?r.history.slice():[];m.push({id:a,opts:d}),y&&e.push({pos:i+1-m.length,ids:m});for(var c=0,g=v.length;c<g;c++)n.push({pos:i+1,ids:v[c],history:m})}return e.reverse()}function Ai(t,e){return t.pos-e.pos}function Ci(t,e,n){for(var r=0,i=t.length,s;r<i;)s=r+i>>>1,n(t[s],e)<0?r=s+1:i=s;return r}function Oi(t,e,n){var r=Ci(t,e,n);t.splice(r,0,e)}function gn(t,e){for(var n,r,i=e,s=t.length;i<s;i++){var a=t[i],d=[a.id,a.opts,[]];r?(r[2].push(d),r=d):n=r=d}return n}function qi(t,e){return t[0]<e[0]?-1:1}function yn(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,a=i.tree2;(s[1].status||a[1].status)&&(s[1].status=s[1].status==="available"||a[1].status==="available"?"available":"missing");for(var d=0;d<a[2].length;d++){if(!s[2][0]){r="new_leaf",s[2][0]=a[2][d];continue}for(var v=!1,y=0;y<s[2].length;y++)s[2][y][0]===a[2][d][0]&&(n.push({tree1:s[2][y],tree2:a[2][d]}),v=!0);v||(r="new_branch",Oi(s[2],a[2][d],qi))}}return{conflicts:r,tree:t}}function cr(t,e,n){var r=[],i=!1,s=!1,a;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var d=0,v=t.length;d<v;d++){var y=t[d];if(y.pos===e.pos&&y.ids[0]===e.ids[0])a=yn(y.ids,e.ids),r.push({pos:y.pos,ids:a.tree}),i=i||a.conflicts,s=!0;else if(n!==!0){var m=y.pos<e.pos?y:e,c=y.pos<e.pos?e:y,g=c.pos-m.pos,w=[],S=[];for(S.push({ids:m.ids,diff:g,parent:null,parentIdx:null});S.length>0;){var C=S.pop();if(C.diff===0){C.ids[0]===c.ids[0]&&w.push(C);continue}for(var p=C.ids[2],h=0,f=p.length;h<f;h++)S.push({ids:p[h],diff:C.diff-1,parent:C.ids,parentIdx:h})}var o=w[0];o?(a=yn(o.ids,c.ids),o.parent[2][o.parentIdx]=a.tree,r.push({pos:m.pos,ids:m.ids}),i=i||a.conflicts,s=!0):r.push(y)}else r.push(y)}return s||r.push(e),r.sort(Ai),{tree:r,conflicts:i||"internal_node"}}function xi(t,e){for(var n=ur(t),r,i,s=0,a=n.length;s<a;s++){var d=n[s],v=d.ids,y;if(v.length>e){r||(r={});var m=v.length-e;y={pos:d.pos+m,ids:gn(v,m)};for(var c=0;c<m;c++){var g=d.pos+c+"-"+v[c].id;r[g]=!0}}else y={pos:d.pos,ids:gn(v,0)};i?i=cr(i,y,!0).tree:i=[y]}return r&&Be(i,function(w,S,C){delete r[S+"-"+C]}),{tree:i,revs:r?Object.keys(r):[]}}function fr(t,e,n){var r=cr(t,e),i=xi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ei(t,e){for(var n=t.slice(),r=e.split("-"),i=parseInt(r[0],10),s=r[1],a;a=n.pop();){if(a.pos===i&&a.ids[0]===s)return!0;for(var d=a.ids[2],v=0,y=d.length;v<y;v++)n.push({pos:a.pos+1,ids:d[v]})}return!1}function ki(t){return t.ids}function qe(t,e){e||(e=Le(t));for(var n=e.substring(e.indexOf("-")+1),r=t.rev_tree.map(ki),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Re(t){return typeof t=="string"&&t.startsWith("_local/")}function Di(t,e){for(var n=e.rev_tree.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,a=s[0],d=s[1],v=s[2],y=v.length===0,m=r.history?r.history.slice():[];if(m.push({id:a,pos:i,opts:d}),y)for(var c=0,g=m.length;c<g;c++){var w=m[c],S=w.pos+"-"+w.id;if(S===t)return i+"-"+a}for(var C=0,p=v.length;C<p;C++)n.push({pos:i+1,ids:v[C],history:m})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function Ti(t,e,n,r){try{t.emit("change",e,n,r)}catch(i){ge("error",'Error in .on("change", function):',i)}}function Pi(t,e,n){var r=[{rev:t._rev}];n.style==="all_docs"&&(r=sn(e.rev_tree).map(function(s){return{rev:s.rev}}));var i={id:e.id,changes:r,doc:t};return qe(e,t._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=an(e),i.doc._conflicts.length||delete i.doc._conflicts),i}class Ri extends xe{constructor(e,n,r){super(),this.db=e,n=n?oe(n):{};var i=n.complete=Yn((d,v)=>{d?ui(this,"error")>0&&this.emit("error",d):this.emit("complete",v),this.removeAllListeners(),e.removeListener("destroyed",s)});r&&(this.on("complete",function(d){r(null,d)}),this.on("error",r));const s=()=>{this.cancel()};e.once("destroyed",s),n.onChange=(d,v,y)=>{this.isCancelled||Ti(this,d,v,y)};var a=new Promise(function(d,v){n.complete=function(y,m){y?v(y):d(m)}});this.once("cancel",function(){e.removeListener("destroyed",s),n.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(d){i(null,d)},i),e.taskqueue.isReady?this.validateChanges(n):e.taskqueue.addTask(d=>{d?n.complete(d):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(e){var n=e.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(e,r=>{if(r)return n(r);this.doChanges(e)}):this.doChanges(e)}doChanges(e){var n=e.complete;if(e=oe(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Pi,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}e.since=i.update_seq,this.doChanges(e)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(e),J._changesFilterPlugin.shouldFilter(this,e))return J._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(i){i in e&&ge("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...s)=>{r.cancel(),i.apply(this,s)}}}}function gt(t,e){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=e,t(n)):t(null,r.length?r[0]:r)}}function Li(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=We(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}function Bi(t,e){if(t._id===e._id){const n=t._revisions?t._revisions.start:0,r=e._revisions?e._revisions.start:0;return n-r}return t._id<e._id?-1:1}function Ii(t){var e={},n=[];return Be(t,function(r,i,s,a){var d=i+"-"+s;return r&&(e[d]=0),a!==void 0&&n.push({from:a,to:d}),d}),n.reverse(),n.forEach(function(r){e[r.from]===void 0?e[r.from]=1+e[r.to]:e[r.from]=Math.min(e[r.from],1+e[r.to])}),e}function ji(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}function lr(t){var e=t._compactionQueue[0],n=e.opts,r=e.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),t._compact(n,function(s,a){s?r(s):r(null,a),Oe(function(){t._compactionQueue.shift(),t._compactionQueue.length&&lr(t)})})})}function $i(t,e,n){return t.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:e,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:e,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return t.put(r)})}function Ni(t){return t.charAt(0)==="_"?t+" is not a valid attachment name, attachment names cannot start with '_'":!1}function yt(t){return t===null||typeof t!="object"||Array.isArray(t)}const Ki=/^\d+-[^-]*$/;function pt(t){return typeof t=="string"&&Ki.test(t)}class dr extends xe{_setup(){this.post=ne("post",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),yt(e))return r(U(_t));this.bulkDocs({docs:[e]},n,gt(r,e._id))}).bind(this),this.put=ne("put",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),yt(e))return r(U(_t));if(nr(e._id),"_rev"in e&&!pt(e._rev))return r(U(et));if(Re(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);const i=a=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(e,n,a):this.bulkDocs({docs:[e]},n,gt(a,e._id))};n.force&&e._rev?(s(),i(function(a){var d=a?null:{ok:!0,id:e._id,rev:e._rev};r(a,d)})):i(r);function s(){var a=e._rev.split("-"),d=a[1],v=parseInt(a[0],10),y=v+1,m=or();e._revisions={start:y,ids:[m,d]},e._rev=y+"-"+m,n.new_edits=!1}}).bind(this),this.putAttachment=ne("putAttachment",function(e,n,r,i,s){var a=this;typeof s=="function"&&(s=i,i=r,r=null),typeof s>"u"&&(s=i,i=r,r=null),s||ge("warn","Attachment",n,"on document",e,"is missing content_type");function d(v){var y="_rev"in v?parseInt(v._rev,10):0;return v._attachments=v._attachments||{},v._attachments[n]={content_type:s,data:i,revpos:++y},a.put(v)}return a.get(e).then(function(v){if(v._rev!==r)throw U(Me);return d(v)},function(v){if(v.reason===ve.message)return d({_id:e});throw v})}).bind(this),this.removeAttachment=ne("removeAttachment",function(e,n,r,i){this.get(e,(s,a)=>{if(s){i(s);return}if(a._rev!==r){i(U(Me));return}if(!a._attachments)return i();delete a._attachments[n],Object.keys(a._attachments).length===0&&delete a._attachments,this.put(a,i)})}).bind(this),this.remove=ne("remove",function(e,n,r,i){var s;typeof n=="string"?(s={_id:e,_rev:n},typeof r=="function"&&(i=r,r={})):(s=e,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var a={_id:s._id,_rev:s._rev||r.rev};if(a._deleted=!0,Re(a._id)&&typeof this._removeLocal=="function")return this._removeLocal(s,i);this.bulkDocs({docs:[a]},r,gt(i,a._id))}).bind(this),this.revsDiff=ne("revsDiff",function(e,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(e);if(!i.length)return r(null,{});var s=0,a=new Map;function d(y,m){a.has(y)||a.set(y,{missing:[]}),a.get(y).missing.push(m)}function v(y,m){var c=e[y].slice(0);Be(m,function(g,w,S,C,p){var h=w+"-"+S,f=c.indexOf(h);f!==-1&&(c.splice(f,1),p.status!=="available"&&d(y,h))}),c.forEach(function(g){d(y,g)})}i.forEach(function(y){this._getRevisionTree(y,function(m,c){if(m&&m.status===404&&m.message==="missing")a.set(y,{missing:e[y]});else{if(m)return r(m);v(y,c)}if(++s===i.length){var g={};return a.forEach(function(w,S){g[S]=w}),r(null,g)}})},this)}).bind(this),this.bulkGet=ne("bulkGet",function(e,n){Vn(this,e,n)}).bind(this),this.compactDocument=ne("compactDocument",function(e,n,r){this._getRevisionTree(e,(i,s)=>{if(i)return r(i);var a=Ii(s),d=[],v=[];Object.keys(a).forEach(function(y){a[y]>n&&d.push(y)}),Be(s,function(y,m,c,g,w){var S=m+"-"+c;w.status==="available"&&d.indexOf(S)!==-1&&v.push(S)}),this._doCompaction(e,v,r)})}).bind(this),this.compact=ne("compact",function(e,n){typeof e=="function"&&(n=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:n}),this._compactionQueue.length===1&&lr(this)}).bind(this),this.get=ne("get",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof e!="string")return r(U(er));if(Re(e)&&typeof this._getLocal=="function")return this._getLocal(e,r);var i=[];const s=()=>{var v=[],y=i.length;if(!y)return r(null,v);i.forEach(m=>{this.get(e,{rev:m,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(c,g){if(c)v.push({missing:m});else{for(var w,S=0,C=v.length;S<C;S++)if(v[S].ok&&v[S].ok._rev===g._rev){w=!0;break}w||v.push({ok:g})}y--,y||r(null,v)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(e,function(v,y){if(v)return r(v);i=sn(y).map(function(m){return m.rev}),s()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var a=0;a<i.length;a++){var d=i[a];if(!pt(d))return r(U(et))}s()}else return r(U(Wt,"function_clause"));return}return this._get(e,n,(v,y)=>{if(v)return v.docId=e,r(v);var m=y.doc,c=y.metadata,g=y.ctx;if(n.conflicts){var w=an(c);w.length&&(m._conflicts=w)}if(qe(c,m._rev)&&(m._deleted=!0),n.revs||n.revs_info){for(var S=m._rev.split("-"),C=parseInt(S[0],10),p=S[1],h=ur(c.rev_tree),f=null,o=0;o<h.length;o++){var u=h[o];const j=u.ids.findIndex(N=>N.id===p);var l=j===C-1;(l||!f&&j!==-1)&&(f=u)}if(!f)return v=new Error("invalid rev tree"),v.docId=e,r(v);const I=m._rev.split("-")[1],G=f.ids.findIndex(j=>j.id===I)+1;var _=f.ids.length-G;if(f.ids.splice(G,_),f.ids.reverse(),n.revs&&(m._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(j){return j.id})}),n.revs_info){var D=f.pos+f.ids.length;m._revs_info=f.ids.map(function(j){return D--,{rev:D+"-"+j.id,status:j.opts.status}})}}if(n.attachments&&m._attachments){var T=m._attachments,k=Object.keys(T).length;if(k===0)return r(null,m);Object.keys(T).forEach(I=>{this._getAttachment(m._id,I,T[I],{binary:n.binary,metadata:c,ctx:g},function(G,j){var N=m._attachments[I];N.data=j,delete N.stub,delete N.length,--k||r(null,m)})})}else{if(m._attachments)for(var $ in m._attachments)Object.prototype.hasOwnProperty.call(m._attachments,$)&&(m._attachments[$].stub=!0);r(null,m)}})}).bind(this),this.getAttachment=ne("getAttachment",function(e,n,r,i){r instanceof Function&&(i=r,r={}),this._get(e,r,(s,a)=>{if(s)return i(s);if(a.doc._attachments&&a.doc._attachments[n])r.ctx=a.ctx,r.binary=!0,r.metadata=a.metadata,this._getAttachment(e,n,a.doc._attachments[n],r,i);else return i(U(ve))})}).bind(this),this.allDocs=ne("allDocs",function(e,n){if(typeof e=="function"&&(n=e,e={}),e.skip=typeof e.skip<"u"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in e})[0];if(r){n(U(si,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Ce(this)&&(ji(e),e.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(e,n)}).bind(this),this.close=ne("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}).bind(this),this.info=ne("info",function(e){this._info((n,r)=>{if(n)return e(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Ce(this)),r.adapter=this.adapter,e(null,r)})}).bind(this),this.id=ne("id",function(e){return this._id(e)}).bind(this),this.bulkDocs=ne("bulkDocs",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(U(ni));for(var i=0;i<e.docs.length;++i){const v=e.docs[i];if(yt(v))return r(U(_t));if("_rev"in v&&!pt(v._rev))return r(U(et))}var s;if(e.docs.forEach(function(v){v._attachments&&Object.keys(v._attachments).forEach(function(y){s=s||Ni(y),v._attachments[y].content_type||ge("warn","Attachment",y,"on document",v._id,"is missing content_type")})}),s)return r(U(ct,s));"new_edits"in n||("new_edits"in e?n.new_edits=e.new_edits:n.new_edits=!0);var a=this;!n.new_edits&&!Ce(a)&&e.docs.sort(Bi),Li(e.docs);var d=e.docs.map(function(v){return v._id});this._bulkDocs(e,n,function(v,y){if(v)return r(v);if(n.new_edits||(y=y.filter(function(g){return g.error})),!Ce(a))for(var m=0,c=y.length;m<c;m++)y[m].id=y[m].id||d[m];r(null,y)})}).bind(this),this.registerDependentDatabase=ne("registerDependentDatabase",function(e,n){var r=oe(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(e,r);function s(a){return a.dependentDbs=a.dependentDbs||{},a.dependentDbs[e]?!1:(a.dependentDbs[e]=!0,a)}rt(this,"_local/_pouch_dependentDbs",s).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=ne("destroy",function(e,n){typeof e=="function"&&(n=e,e={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(e,(s,a)=>{if(s)return n(s);this._destroyed=!0,this.emit("destroyed"),n(null,a||{ok:!0})})};if(Ce(this))return i();this.get("_local/_pouch_dependentDbs",(s,a)=>{if(s)return s.status!==404?n(s):i();var d=a.dependentDbs,v=this.constructor,y=Object.keys(d).map(m=>{var c=r?m.replace(new RegExp("^"+v.prefix),""):m;return new v(c,this.__opts).destroy()});Promise.all(y).then(i,n)})}).bind(this)}_compact(e,n){var r={return_docs:!1,last_seq:e.last_seq||0,since:e.last_seq||0},i=[],s,a=0;const d=m=>{this.activeTasks.update(s,{completed_items:++a}),i.push(this.compactDocument(m.id,0))},v=m=>{this.activeTasks.remove(s,m),n(m)},y=m=>{var c=m.last_seq;Promise.all(i).then(()=>rt(this,"_local/compaction",g=>!g.last_seq||g.last_seq<c?(g.last_seq=c,g):!1)).then(()=>{this.activeTasks.remove(s),n(null,{ok:!0})}).catch(v)};this.info().then(m=>{s=this.activeTasks.add({name:"database_compaction",total_items:m.update_seq-r.last_seq}),this.changes(r).on("change",d).on("complete",y).on("error",v)})}changes(e,n){return typeof e=="function"&&(n=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new Ri(this,e,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}dr.prototype.purge=ne("_purge",function(t,e,n){if(typeof this._purge>"u")return n(U(Wt,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(t,(i,s)=>{if(i)return n(i);if(!s)return n(U(ve));let a;try{a=Si(s,e)}catch(d){return n(d.message||d)}r._purge(t,a,(d,v)=>{if(d)return n(d);$i(r,t,e).then(function(){return n(null,v)})})})});class Fi{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()}fail(e){this.failed=e,this.execute()}ready(e){this.isReady=!0,this.db=e,this.execute()}addTask(e){this.queue.push(e),this.failed&&this.execute()}}function Mi(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,s=J.prefix,a=e.adapter;if(!a)for(var d=0;d<i.length;++d){if(a=i[d],a==="idb"&&"websql"in r&&nt()&&localStorage["_pouch__websqldb_"+s+t]){ge("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var v=r[a],y=v&&"use_prefix"in v?v.use_prefix:!0;return{name:y?s+t:t,adapter:a}}function Ui(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}function hr(t,e){let n=function(...r){if(!(this instanceof n))return new n(...r);e.apply(this,r)};return Ui(n,t),n}function Gi(t){function e(r){t.removeListener("closed",n),r||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}class pn extends dr{constructor(e,n){super(),this._setup(e,n)}_setup(e,n){if(super._setup(),n=n||{},e&&typeof e=="object"&&(n=e,e=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=oe(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+e,i=Mi(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=e,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new Fi,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,s=>{if(s)return this.taskqueue.fail(s);Gi(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}}const J=hr(pn,function(t,e){pn.prototype._setup.call(this,t,e)});var vr=fetch,Ke=Headers;class Ji{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(e){const n=zt();return this.tasks[n]={id:n,name:e.name,total_items:e.total_items,created_at:new Date().toJSON()},n}get(e){return this.tasks[e]}remove(e,n){return delete this.tasks[e],this.tasks}update(e,n){const r=this.tasks[e];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[e]=i}return this.tasks}}J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var mn=new xe;function zi(t){Object.keys(xe.prototype).forEach(function(n){typeof xe.prototype[n]=="function"&&(t[n]=mn[n].bind(mn))});var e=t._destructionListeners=new Map;t.on("ref",function(r){e.has(r.name)||e.set(r.name,[]),e.get(r.name).push(r)}),t.on("unref",function(r){if(e.has(r.name)){var i=e.get(r.name),s=i.indexOf(r);s<0||(i.splice(s,1),i.length>1?e.set(r.name,i):e.delete(r.name))}}),t.on("destroyed",function(r){if(e.has(r)){var i=e.get(r);e.delete(r),i.forEach(function(s){s.emit("destroyed",!0)})}})}zi(J);J.adapter=function(t,e,n){e.valid()&&(J.adapters[t]=e,n&&J.preferredAdapters.push(t))};J.plugin=function(t){if(typeof t=="function")t(J);else{if(typeof t!="object"||Object.keys(t).length===0)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){J.prototype[e]=t[e]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(t){let e=hr(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},e.__defaults,r),J.call(this,n,r)});return e.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in e||(e[n]=J[n])}),e.__defaults=Object.assign({},this.__defaults,t),e};J.fetch=function(t,e){return vr(t,e)};J.prototype.activeTasks=J.activeTasks=new Ji;var Qi="9.0.0";function on(t,e){for(var n=t,r=0,i=e.length;r<i;r++){var s=e[r];if(n=n[s],!n)break}return n}function Wi(t,e){return t<e?-1:t>e?1:0}function un(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var s=t[r];r>0&&t[r-1]==="\\"&&(s==="$"||s===".")?n=n.substring(0,n.length-1)+s:s==="."?(e.push(n),n=""):n+=s}return e.push(n),e}var Hi=["$or","$nor","$not"];function _r(t){return Hi.indexOf(t)>-1}function gr(t){return Object.keys(t)[0]}function Xi(t){return t[gr(t)]}function Qe(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(i){var s=r[i];if(typeof s!="object"&&(s={$eq:s}),_r(i))if(s instanceof Array){if(n[i]){n[i]=!1,e[i]=s;return}var a=[];e[i].forEach(function(v){Object.keys(s).forEach(function(y){var m=s[y],c=Math.max(Object.keys(v).length,Object.keys(m).length),g=Qe([v,m]);Object.keys(g).length<=c||a.push(g)})}),e[i]=a}else e[i]=Qe([s]);else{var d=e[i]=e[i]||{};Object.keys(s).forEach(function(v){var y=s[v];if(v==="$gt"||v==="$gte")return Yi(v,y,d);if(v==="$lt"||v==="$lte")return Zi(v,y,d);if(v==="$ne")return Vi(y,d);if(v==="$eq")return es(y,d);if(v==="$regex")return ts(y,d);d[v]=y})}})}),e}function Yi(t,e,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?t==="$gte"?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):typeof n.$gt<"u"?t==="$gte"?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function Zi(t,e,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?t==="$lte"?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):typeof n.$lt<"u"?t==="$lte"?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function Vi(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function es(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function ts(t,e){"$regex"in e?e.$regex.push(t):e.$regex=[t]}function yr(t){for(var e in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=Qe(t[n].$and));var r=t[e];typeof r=="object"&&yr(r)}return t}function pr(t,e){for(var n in t){n==="$and"&&(e=!0);var r=t[n];typeof r=="object"&&(e=pr(r,e))}return e}function ns(t){var e=oe(t);pr(e,!1)&&(e=yr(e),"$and"in e&&(e=Qe(e.$and))),["$or","$nor"].forEach(function(a){a in e&&e[a].forEach(function(d){for(var v=Object.keys(d),y=0;y<v.length;y++){var m=v[y],c=d[m];(typeof c!="object"||c===null)&&(d[m]={$eq:c})}})}),"$not"in e&&(e.$not=Qe([e.$not]));for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],s=e[i];(typeof s!="object"||s===null)&&(s={$eq:s}),e[i]=s}return Pt(e),e}function Pt(t){Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Pt(r)}):e==="$ne"?t.$ne=[n]:e==="$regex"?t.$regex=[n]:n&&typeof n=="object"&&Pt(n)})}function rs(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}function is(t,e,n){var r=rs(t,e,n);return r+t}var mr=-324,Rt=3,Lt="";function re(t,e){if(t===e)return 0;t=Ie(t),e=Ie(e);var n=Bt(t),r=Bt(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return fs(t,e)}return Array.isArray(t)?cs(t,e):ls(t,e)}function Ie(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=Ie(e[r])}else{if(t instanceof Date)return t.toJSON();if(t!==null){t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s<"u"&&(t[i]=Ie(s))}}}}return t}function ss(t){if(t!==null)switch(typeof t){case"boolean":return t?1:0;case"number":return ds(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,s="";if(e)for(;++r<i;)s+=me(n[r]);else for(;++r<i;){var a=n[r];s+=me(a)+me(t[a])}return s}return""}function me(t){var e="\0";return t=Ie(t),Bt(t)+Lt+ss(t)+e}function as(t,e){var n=e,r,i=t[e]==="1";if(i)r=0,e++;else{var s=t[e]==="0";e++;var a="",d=t.substring(e,e+Rt),v=parseInt(d,10)+mr;for(s&&(v=-v),e+=Rt;;){var y=t[e];if(y==="\0")break;a+=y,e++}a=a.split("."),a.length===1?r=parseInt(a,10):r=parseFloat(a[0]+"."+a[1]),s&&(r=r-10),v!==0&&(r=parseFloat(r+"e"+v))}return{num:r,length:e-n}}function os(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(n);else if(s===t.length-2){var a=t.pop();i[a]=n}else t.push(n)}}function us(t){for(var e=[],n=[],r=0;;){var i=t[r++];if(i==="\0"){if(e.length===1)return e.pop();os(e,n);continue}switch(i){case"1":e.push(null);break;case"2":e.push(t[r]==="1"),r++;break;case"3":var s=as(t,r);e.push(s.num),r+=s.length;break;case"4":for(var a="";;){var d=t[r];if(d==="\0")break;a+=d,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(a);break;case"5":var v={element:[],index:e.length};e.push(v.element),n.push(v);break;case"6":var y={element:{},index:e.length};e.push(y.element),n.push(y);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function cs(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=re(t[r],e[r]);if(i!==0)return i}return t.length===e.length?0:t.length>e.length?1:-1}function fs(t,e){return t===e?0:t>e?1:-1}function ls(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),s=0;s<i;s++){var a=re(n[s],r[s]);if(a!==0||(a=re(t[n[s]],e[r[s]]),a!==0))return a}return n.length===r.length?0:n.length>r.length?1:-1}function Bt(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);if(~n)return t===null?1:Array.isArray(t)?5:n<3?n+2:n+3;if(Array.isArray(t))return 5}function ds(t){if(t===0)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",s=(r?-n:n)-mr,a=is(s.toString(),"0",Rt);i+=Lt+a;var d=Math.abs(parseFloat(e[0]));r&&(d=10-d);var v=d.toFixed(20);return v=v.replace(/\.?0+$/,""),i+=Lt+v,i}function hs(t){function e(n){return t.map(function(r){var i=gr(r),s=un(i),a=on(n,s);return a})}return function(n,r){var i=e(n.doc),s=e(r.doc),a=re(i,s);return a!==0?a:Wi(n.doc._id,r.doc._id)}}function vs(t,e,n){if(t=t.filter(function(a){return Fe(a.doc,e.selector,n)}),e.sort){var r=hs(e.sort);t=t.sort(r),typeof e.sort[0]!="string"&&Xi(e.sort[0])==="desc"&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,s=("limit"in e?e.limit:t.length)+i;t=t.slice(i,s)}return t}function Fe(t,e,n){return n.every(function(r){var i=e[r],s=un(r),a=on(t,s);return _r(r)?_s(r,i,t):it(i,t,s,a)})}function it(t,e,n,r){return t?typeof t=="object"?Object.keys(t).every(function(i){var s=t[i];if(i.indexOf("$")===0)return wn(i,e,s,n,r);var a=un(i);if(r===void 0&&typeof s!="object"&&a.length>0)return!1;var d=on(r,a);return typeof s=="object"?it(s,e,n,d):wn("$eq",e,s,a,d)}):t===r:!0}function _s(t,e,n){return t==="$or"?e.some(function(r){return Fe(n,r,Object.keys(r))}):t==="$not"?!Fe(n,e,Object.keys(e)):!e.find(function(r){return Fe(n,r,Object.keys(r))})}function wn(t,e,n,r,i){if(!Sn[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Sn[t](e,n,r,i)}function Je(t){return typeof t<"u"&&t!==null}function Ee(t){return typeof t<"u"}function gs(t,e){if(typeof t!="number"||parseInt(t,10)!==t)return!1;var n=e[0],r=e[1];return t%n===r}function bn(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return re(n,r)===0}):re(n,t)===0})}function ys(t,e){return e.every(function(n){return t.some(function(r){return re(n,r)===0})})}function ps(t,e){return t.length===e}function ms(t,e){var n=new RegExp(e);return n.test(t)}function ws(t,e){switch(e){case"null":return t===null;case"boolean":return typeof t=="boolean";case"number":return typeof t=="number";case"string":return typeof t=="string";case"array":return t instanceof Array;case"object":return{}.toString.call(t)==="[object Object]"}}var Sn={$elemMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return Fe(i,e,Object.keys(e))}):r.some(function(i){return it(e,t,n,i)})},$allMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return Fe(i,e,Object.keys(e))}):r.every(function(i){return it(e,t,n,i)})},$eq:function(t,e,n,r){return Ee(r)&&re(r,e)===0},$gte:function(t,e,n,r){return Ee(r)&&re(r,e)>=0},$gt:function(t,e,n,r){return Ee(r)&&re(r,e)>0},$lte:function(t,e,n,r){return Ee(r)&&re(r,e)<=0},$lt:function(t,e,n,r){return Ee(r)&&re(r,e)<0},$exists:function(t,e,n,r){return e?Ee(r):!Ee(r)},$mod:function(t,e,n,r){return Je(r)&&gs(r,e)},$ne:function(t,e,n,r){return e.every(function(i){return re(r,i)!==0})},$in:function(t,e,n,r){return Je(r)&&bn(r,e)},$nin:function(t,e,n,r){return Je(r)&&!bn(r,e)},$size:function(t,e,n,r){return Je(r)&&Array.isArray(r)&&ps(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&ys(r,e)},$regex:function(t,e,n,r){return Je(r)&&typeof r=="string"&&e.every(function(i){return ms(r,i)})},$type:function(t,e,n,r){return ws(r,e)}};function bs(t,e){if(typeof e!="object")throw new Error("Selector error: expected a JSON object");e=ns(e);var n={doc:t},r=vs([n],{selector:e},Object.keys(e));return r&&r.length===1}function Ss(t){return Yt(`"use strict";
return `+t+";",{})}function As(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Yt(e,{})}function Cs(t,e){if(t.selector&&t.filter&&t.filter!=="_selector"){var n=typeof t.filter=="string"?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function Os(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&typeof t.filter=="string"&&(t.filter==="_view"?t.view=hn(t.view):t.filter=hn(t.filter))}function qs(t,e){return e.filter&&typeof e.filter=="string"&&!e.doc_ids&&!Ce(t.db)}function xs(t,e){var n=e.complete;if(e.filter==="_view"){if(!e.view||typeof e.view!="string"){var r=U(ct,"`view` filter parameter not found or invalid.");return n(r)}var i=Tt(e.view);t.db.get("_design/"+i[0],function(a,d){if(t.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Ue(a));var v=d&&d.views&&d.views[i[1]]&&d.views[i[1]].map;if(!v)return n(U(ve,d.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=As(v),t.doChanges(e)})}else if(e.selector)e.filter=function(a){return bs(a,e.selector)},t.doChanges(e);else{var s=Tt(e.filter);t.db.get("_design/"+s[0],function(a,d){if(t.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Ue(a));var v=d&&d.filters&&d.filters[s[1]];if(!v)return n(U(ve,d&&d.filters?"missing json key: "+s[1]:"missing json key: filters"));e.filter=Ss(v),t.doChanges(e)})}}function Es(t){t._changesFilterPlugin={validate:Cs,normalize:Os,shouldFilter:qs,filter:xs}}J.plugin(Es);J.version=Qi;function ks(t,e,n){return new Promise(function(r){var i=Vt([""]);let s;{const a=n;s=t.objectStore(e).put(i,a)}s.onsuccess=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),d=navigator.userAgent.match(/Edge\//);r(d||!a||parseInt(a[1],10)>=43)},s.onerror=t.onabort=function(a){a.preventDefault(),a.stopPropagation(),r(!1)}}).catch(function(){return!1})}function wr(t){return t.reduce(function(e,n){return e[n]=!0,e},{})}var Ds=wr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Ts=wr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function An(t){if(!/^\d+-/.test(t))return U(et);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Ps(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],s=1,a=r.length;s<a;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}function br(t,e,n){n||(n={deterministic_revs:!0});var r,i,s,a={status:"available"};if(t._deleted&&(a.deleted=!0),e)if(t._id||(t._id=ft()),i=or(t,n.deterministic_revs),t._rev){if(s=An(t._rev),s.error)return s;t._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,a,[]]]]}],r=s.prefix+1}else t._rev_tree=[{pos:1,ids:[i,a,[]]}],r=1;else if(t._revisions&&(t._rev_tree=Ps(t._revisions,a),r=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if(s=An(t._rev),s.error)return s;r=s.prefix,i=s.id,t._rev_tree=[{pos:r,ids:[i,a,[]]}]}nr(t._id),t._rev=r+"-"+i;var d={metadata:{},data:{}};for(var v in t)if(Object.prototype.hasOwnProperty.call(t,v)){var y=v[0]==="_";if(y&&!Ds[v]){var m=U(dn,v);throw m.message=dn.message+": "+v,m}else y&&!Ts[v]?d.metadata[v.slice(1)]=t[v]:d.data[v]=t[v]}return d}function Rs(t){try{return Zt(t)}catch{var e=U(tr,"Attachment is not a valid base64 string");return{error:e}}}function Ls(t,e,n){var r=Rs(t.data);if(r.error)return n(r.error);t.length=r.length,e==="blob"?t.data=en(r,t.content_type):e==="base64"?t.data=He(r):t.data=r,rn(r,function(i){t.digest="md5-"+i,n()})}function Bs(t,e,n){rn(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,e==="binary"?sr(t.data,function(i){t.data=i,n()}):e==="base64"?nn(t.data,function(i){t.data=i,n()}):n()})}function Is(t,e,n){if(t.stub)return n();typeof t.data=="string"?Ls(t,e,n):Bs(t,e,n)}function js(t,e,n){if(!t.length)return n();var r=0,i;t.forEach(function(a){var d=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],v=0;if(!d.length)return s();function y(c){i=c,v++,v===d.length&&s()}for(var m in a.data._attachments)Object.prototype.hasOwnProperty.call(a.data._attachments,m)&&Is(a.data._attachments[m],e,y)});function s(){r++,t.length===r&&(i?n(i):n())}}function $s(t,e,n,r,i,s,a,d){if(Ei(e.rev_tree,n.metadata.rev)&&!d)return r[i]=n,s();var v=e.winningRev||Le(e),y="deleted"in e?e.deleted:qe(e,v),m="deleted"in n.metadata?n.metadata.deleted:qe(n.metadata),c=/^1-/.test(n.metadata.rev);if(y&&!m&&d&&c){var g=n.data;g._rev=v,g._id=n.metadata.id,n=br(g,d)}var w=fr(e.rev_tree,n.metadata.rev_tree[0],t),S=d&&(y&&m&&w.conflicts!=="new_leaf"||!y&&w.conflicts!=="new_leaf"||y&&!m&&w.conflicts==="new_branch");if(S){var C=U(Me);return r[i]=C,s()}var p=n.metadata.rev;n.metadata.rev_tree=w.tree,n.stemmedRevs=w.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var h=Le(n.metadata),f=qe(n.metadata,h),o=y===f?0:y<f?-1:1,u;p===h?u=f:u=qe(n.metadata,p),a(n,h,f,u,!0,o,i,s)}function Ns(t){return t.metadata.rev_tree[0].ids[1].status==="missing"}function Ks(t,e,n,r,i,s,a,d,v){t=t||1e3;function y(C,p,h){var f=Le(C.metadata),o=qe(C.metadata,f);if("was_delete"in d&&o)return s[p]=U(ve,"deleted"),h();var u=m&&Ns(C);if(u){var l=U(Me);return s[p]=l,h()}var _=o?0:1;a(C,f,o,o,!1,_,p,h)}var m=d.new_edits,c=new Map,g=0,w=e.length;function S(){++g===w&&v&&v()}e.forEach(function(C,p){if(C._id&&Re(C._id)){var h=C._deleted?"_removeLocal":"_putLocal";n[h](C,{ctx:i},function(o,u){s[p]=o||u,S()});return}var f=C.metadata.id;c.has(f)?(w--,c.get(f).push([C,p])):c.set(f,[[C,p]])}),c.forEach(function(C,p){var h=0;function f(){++h<C.length?o():S()}function o(){var u=C[h],l=u[0],_=u[1];if(r.has(p))$s(t,r.get(p),l,s,_,f,a,m);else{var D=fr([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=D.tree,l.stemmedRevs=D.stemmedRevs||[],y(l,_,f)}}o()})}var Fs=5,se="document-store",fe="by-sequence",_e="attach-store",Te="attach-seq-store",le="meta-store",Se="local-store",mt="detect-blob-support";function Ms(t){try{return JSON.parse(t)}catch{return ot.parse(t)}}function Us(t){try{return JSON.stringify(t)}catch{return ot.stringify(t)}}function Ae(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(U(Ht,n,e.type))}}function It(t,e,n){return{data:Us(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function Pe(t){if(!t)return null;var e=Ms(t.data);return e.winningRev=t.winningRev,e.deleted=t.deletedOrLocal==="1",e.seq=t.seq,e}function st(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function Sr(t,e,n,r){n?r(t?typeof t!="string"?t:tn(t,e):Vt([""],{type:e})):t?typeof t!="string"?ir(t,function(i){r(He(i))}):r(t):r("")}function Ar(t,e,n,r){var i=Object.keys(t._attachments||{});if(!i.length)return r&&r();var s=0;function a(){++s===i.length&&r&&r()}function d(v,y){var m=v._attachments[y],c=m.digest,g=n.objectStore(_e).get(c);g.onsuccess=function(w){m.body=w.target.result.body,a()}}i.forEach(function(v){e.attachments&&e.include_docs?d(t,v):(t._attachments[v].stub=!0,a())})}function jt(t,e){return Promise.all(t.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var s=n.doc._attachments[i];if("body"in s){var a=s.body,d=s.content_type;return new Promise(function(v){Sr(a,d,e,function(y){n.doc._attachments[i]=Object.assign(We(s,["digest","content_type"]),{data:y}),v()})})}}))}}))}function Cr(t,e,n){var r=[],i=n.objectStore(fe),s=n.objectStore(_e),a=n.objectStore(Te),d=t.length;function v(){d--,d||y()}function y(){r.length&&r.forEach(function(m){var c=a.index("digestSeq").count(IDBKeyRange.bound(m+"::",m+"::",!1,!1));c.onsuccess=function(g){var w=g.target.result;w||s.delete(m)}})}t.forEach(function(m){var c=i.index("_doc_id_rev"),g=e+"::"+m;c.getKey(g).onsuccess=function(w){var S=w.target.result;if(typeof S!="number")return v();i.delete(S);var C=a.index("seq").openCursor(IDBKeyRange.only(S));C.onsuccess=function(p){var h=p.target.result;if(h){var f=h.value.digestSeq.split("::")[0];r.push(f),a.delete(h.primaryKey),h.continue()}else v()}}})}function we(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}var ze=new Vr;function Gs(t,e,n,r,i,s){for(var a=e.docs,d,v,y,m,c,g,w,S,C=0,p=a.length;C<p;C++){var h=a[C];h._id&&Re(h._id)||(h=a[C]=br(h,n.new_edits,t),h.error&&!w&&(w=h))}if(w)return s(w);var f=!1,o=0,u=new Array(a.length),l=new Map,_=!1,D=r._meta.blobSupport?"blob":"base64";js(a,D,function(q){if(q)return s(q);T()});function T(){var q=[se,fe,_e,Se,Te,le],P=we(i,q,"readwrite");if(P.error)return s(P.error);d=P.txn,d.onabort=Ae(s),d.ontimeout=Ae(s),d.oncomplete=j,v=d.objectStore(se),y=d.objectStore(fe),m=d.objectStore(_e),c=d.objectStore(Te),g=d.objectStore(le),g.get(le).onsuccess=function(B){S=B.target.result,I()},z(function(B){if(B)return _=!0,s(B);G()})}function k(){f=!0,I()}function $(){Ks(t.revs_limit,a,r,l,d,u,Q,n,k)}function I(){!S||!f||(S.docCount+=o,g.put(S))}function G(){if(!a.length)return;var q=0;function P(){++q===a.length&&$()}function B(L){var K=Pe(L.target.result);K&&l.set(K.id,K),P()}for(var M=0,R=a.length;M<R;M++){var O=a[M];if(O._id&&Re(O._id)){P();continue}var x=v.get(O.metadata.id);x.onsuccess=B}}function j(){_||(ze.notify(r._meta.name),s(null,u))}function N(q,P){var B=m.get(q);B.onsuccess=function(M){if(M.target.result)P();else{var R=U(ai,"unknown stub attachment with digest "+q);R.status=412,P(R)}}}function z(q){var P=[];if(a.forEach(function(O){O.data&&O.data._attachments&&Object.keys(O.data._attachments).forEach(function(x){var L=O.data._attachments[x];L.stub&&P.push(L.digest)})}),!P.length)return q();var B=0,M;function R(){++B===P.length&&q(M)}P.forEach(function(O){N(O,function(x){x&&!M&&(M=x),R()})})}function Q(q,P,B,M,R,O,x,L){q.metadata.winningRev=P,q.metadata.deleted=B;var K=q.data;K._id=q.metadata.id,K._rev=q.metadata.rev,M&&(K._deleted=!0);var F=K._attachments&&Object.keys(K._attachments).length;if(F)return b(q,P,B,R,x,L);o+=O,I(),W(q,P,B,R,x,L)}function W(q,P,B,M,R,O){var x=q.data,L=q.metadata;x._doc_id_rev=L.id+"::"+L.rev,delete x._id,delete x._rev;function K(ie){var de=q.stemmedRevs||[];M&&r.auto_compaction&&(de=de.concat(bi(q.metadata))),de&&de.length&&Cr(de,q.metadata.id,d),L.seq=ie.target.result;var be=It(L,P,B),X=v.put(be);X.onsuccess=Y}function F(ie){ie.preventDefault(),ie.stopPropagation();var de=y.index("_doc_id_rev"),be=de.getKey(x._doc_id_rev);be.onsuccess=function(X){var H=y.put(x,X.target.result);H.onsuccess=K}}function Y(){u[R]={ok:!0,id:L.id,rev:L.rev},l.set(q.metadata.id,q.metadata),A(q,L.seq,O)}var te=y.put(x);te.onsuccess=K,te.onerror=F}function b(q,P,B,M,R,O){var x=q.data,L=0,K=Object.keys(x._attachments);function F(){L===K.length&&W(q,P,B,M,R,O)}function Y(){L++,F()}K.forEach(function(te){var ie=q.data._attachments[te];if(ie.stub)L++,F();else{var de=ie.data;delete ie.data,ie.revpos=parseInt(P,10);var be=ie.digest;E(be,de,Y)}})}function A(q,P,B){var M=0,R=Object.keys(q.data._attachments||{});if(!R.length)return B();function O(){++M===R.length&&B()}function x(K){var F=q.data._attachments[K].digest,Y=c.put({seq:P,digestSeq:F+"::"+P});Y.onsuccess=O,Y.onerror=function(te){te.preventDefault(),te.stopPropagation(),O()}}for(var L=0;L<R.length;L++)x(R[L])}function E(q,P,B){var M=m.count(q);M.onsuccess=function(R){var O=R.target.result;if(O)return B();var x={digest:q,body:P},L=m.put(x);L.onsuccess=B}}}function Or(t,e,n,r,i){r===-1&&(r=1e3);var s=typeof t.getAll=="function"&&typeof t.getAllKeys=="function"&&r>1&&!n,a,d,v;function y(w){d=w.target.result,a&&i(a,d,v)}function m(w){a=w.target.result,d&&i(a,d,v)}function c(){if(!a.length)return i();var w=a[a.length-1],S;if(e&&e.upper)try{S=IDBKeyRange.bound(w,e.upper,!0,e.upperOpen)}catch(C){if(C.name==="DataError"&&C.code===0)return i()}else S=IDBKeyRange.lowerBound(w,!0);e=S,a=null,d=null,t.getAll(e,r).onsuccess=y,t.getAllKeys(e,r).onsuccess=m}function g(w){var S=w.target.result;if(!S)return i();i([S.key],[S.value],S)}s?(v={continue:c},t.getAll(e,r).onsuccess=y,t.getAllKeys(e,r).onsuccess=m):n?t.openCursor(e,"prev").onsuccess=g:t.openCursor(e).onsuccess=g}function Js(t,e,n){if(typeof t.getAll=="function"){t.getAll(e).onsuccess=n;return}var r=[];function i(s){var a=s.target.result;a?(r.push(a.value),a.continue()):n({target:{result:r}})}t.openCursor(e).onsuccess=i}function zs(t,e,n){var r=new Array(t.length),i=0;t.forEach(function(s,a){e.get(s).onsuccess=function(d){d.target.result?r[a]=d.target.result:r[a]={key:s,error:"not_found"},i++,i===t.length&&n(t,r,{})}})}function Qs(t,e,n,r,i){try{if(t&&e)return i?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return i?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return i?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(s){return{error:s}}return null}function Ws(t,e,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,s="key"in t?t.key:!1,a="keys"in t?t.keys:!1,d=t.skip||0,v=typeof t.limit=="number"?t.limit:-1,y=t.inclusive_end!==!1,m,c;if(!a&&(m=Qs(r,i,y,s,t.descending),c=m&&m.error,c&&!(c.name==="DataError"&&c.code===0)))return n(U(Ht,c.name,c.message));var g=[se,fe,le];t.attachments&&g.push(_e);var w=we(e,g,"readonly");if(w.error)return n(w.error);var S=w.txn;S.oncomplete=G,S.onabort=Ae(n);var C=S.objectStore(se),p=S.objectStore(fe),h=S.objectStore(le),f=p.index("_doc_id_rev"),o=[],u,l;h.get(le).onsuccess=function(j){u=j.target.result.docCount},t.update_seq&&(p.openKeyCursor(null,"prev").onsuccess=j=>{var N=j.target.result;N&&N.key&&(l=N.key)});function _(j,N,z){var Q=j.id+"::"+z;f.get(Q).onsuccess=function(b){if(N.doc=st(b.target.result)||{},t.conflicts){var A=an(j);A.length&&(N.doc._conflicts=A)}Ar(N.doc,t,S)}}function D(j,N){var z={id:N.id,key:N.id,value:{rev:j}},Q=N.deleted;Q?a&&(o.push(z),z.value.deleted=!0,z.doc=null):d--<=0&&(o.push(z),t.include_docs&&_(N,z,j))}function T(j){for(var N=0,z=j.length;N<z&&o.length!==v;N++){var Q=j[N];if(Q.error&&a){o.push(Q);continue}var W=Pe(Q),b=W.winningRev;D(b,W)}}function k(j,N,z){z&&(T(N),o.length<v&&z.continue())}function $(j){var N=j.target.result;t.descending&&(N=N.reverse()),T(N)}function I(){var j={total_rows:u,offset:t.skip,rows:o};t.update_seq&&l!==void 0&&(j.update_seq=l),n(null,j)}function G(){t.attachments?jt(o,t.binary).then(I):I()}if(!(c||v===0)){if(a)return zs(a,C,k);if(v===-1)return Js(C,m,$);Or(C,m,t.descending,v+d,k)}}function Hs(t,e){var n=t.objectStore(se).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){e(r.target.result)}}var $t=!1,Nt=[];function Xs(t,e,n,r){try{t(e,n)}catch(i){r.emit("error",i)}}function Cn(){$t||!Nt.length||($t=!0,Nt.shift()())}function Ys(t,e,n){Nt.push(function(){t(function(s,a){Xs(e,s,a,n),$t=!1,Oe(function(){Cn()})})}),Cn()}function Zs(t,e,n,r){if(t=oe(t),t.continuous){var i=n+":"+ft();return ze.addListener(n,i,e,t),ze.notify(n),{cancel:function(){ze.removeListener(n,i)}}}var s=t.doc_ids&&new Set(t.doc_ids);t.since=t.since||0;var a=t.since,d="limit"in t?t.limit:-1;d===0&&(d=1);var v=[],y=0,m=Xt(t),c=new Map,g,w,S,C;function p(T,k,$){if(!$||!T.length)return;var I=new Array(T.length),G=new Array(T.length);function j(Q,W){var b=t.processChange(W,Q,t);a=b.seq=Q.seq;var A=m(b);return typeof A=="object"?Promise.reject(A):A?(y++,t.return_docs&&v.push(b),t.attachments&&t.include_docs?new Promise(function(E){Ar(W,t,g,function(){jt([b],t.binary).then(function(){E(b)})})}):Promise.resolve(b)):Promise.resolve()}function N(){for(var Q=[],W=0,b=I.length;W<b&&y!==d;W++){var A=I[W];if(A){var E=G[W];Q.push(j(E,A))}}Promise.all(Q).then(function(q){for(var P=0,B=q.length;P<B;P++)q[P]&&t.onChange(q[P])}).catch(t.complete),y!==d&&$.continue()}var z=0;k.forEach(function(Q,W){var b=st(Q),A=T[W];f(b,A,function(E,q){G[W]=E,I[W]=q,++z===T.length&&N()})})}function h(T,k,$,I){if($.seq!==k)return I();if($.winningRev===T._rev)return I($,T);var G=T._id+"::"+$.winningRev,j=C.get(G);j.onsuccess=function(N){I($,st(N.target.result))}}function f(T,k,$){if(s&&!s.has(T._id))return $();var I=c.get(T._id);if(I)return h(T,k,I,$);S.get(T._id).onsuccess=function(G){I=Pe(G.target.result),c.set(T._id,I),h(T,k,I,$)}}function o(){t.complete(null,{results:v,last_seq:a})}function u(){!t.continuous&&t.attachments?jt(v).then(o):o()}var l=[se,fe];t.attachments&&l.push(_e);var _=we(r,l,"readonly");if(_.error)return t.complete(_.error);g=_.txn,g.onabort=Ae(t.complete),g.oncomplete=u,w=g.objectStore(fe),S=g.objectStore(se),C=w.index("_doc_id_rev");var D=t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null;Or(w,D,t.descending,d,p)}var $e=new Map,wt,bt=new Map;function qr(t,e){var n=this;Ys(function(r){Vs(n,t,r)},e,n.constructor)}function Vs(t,e,n){var r=e.name,i=null,s=null;t._meta=null;function a(p){return function(h,f){h&&h instanceof Error&&!h.reason&&s&&(h.reason=s),p(h,f)}}function d(p){var h=p.createObjectStore(se,{keyPath:"id"});p.createObjectStore(fe,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),p.createObjectStore(_e,{keyPath:"digest"}),p.createObjectStore(le,{keyPath:"id",autoIncrement:!1}),p.createObjectStore(mt),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),p.createObjectStore(Se,{keyPath:"_id"});var f=p.createObjectStore(Te,{autoIncrement:!0});f.createIndex("seq","seq"),f.createIndex("digestSeq","digestSeq",{unique:!0})}function v(p,h){var f=p.objectStore(se);f.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),f.openCursor().onsuccess=function(o){var u=o.target.result;if(u){var l=u.value,_=qe(l);l.deletedOrLocal=_?"1":"0",f.put(l),u.continue()}else h()}}function y(p){p.createObjectStore(Se,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function m(p,h){var f=p.objectStore(Se),o=p.objectStore(se),u=p.objectStore(fe),l=o.openCursor();l.onsuccess=function(_){var D=_.target.result;if(D){var T=D.value,k=T.id,$=Re(k),I=Le(T);if($){var G=k+"::"+I,j=k+"::",N=k+"::~",z=u.index("_doc_id_rev"),Q=IDBKeyRange.bound(j,N,!1,!1),W=z.openCursor(Q);W.onsuccess=function(b){if(W=b.target.result,!W)o.delete(D.primaryKey),D.continue();else{var A=W.value;A._doc_id_rev===G&&f.put(A),u.delete(W.primaryKey),W.continue()}}}else D.continue()}else h&&h()}}function c(p){var h=p.createObjectStore(Te,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function g(p,h){var f=p.objectStore(fe),o=p.objectStore(_e),u=p.objectStore(Te),l=o.count();l.onsuccess=function(_){var D=_.target.result;if(!D)return h();f.openCursor().onsuccess=function(T){var k=T.target.result;if(!k)return h();for(var $=k.value,I=k.primaryKey,G=Object.keys($._attachments||{}),j={},N=0;N<G.length;N++){var z=$._attachments[G[N]];j[z.digest]=!0}var Q=Object.keys(j);for(N=0;N<Q.length;N++){var W=Q[N];u.put({seq:I,digestSeq:W+"::"+I})}k.continue()}}}function w(p){function h(l){return l.data?Pe(l):(l.deleted=l.deletedOrLocal==="1",l)}var f=p.objectStore(fe),o=p.objectStore(se),u=o.openCursor();u.onsuccess=function(l){var _=l.target.result;if(!_)return;var D=h(_.value);D.winningRev=D.winningRev||Le(D);function T(){var $=D.id+"::",I=D.id+"::",G=f.index("_doc_id_rev").openCursor(IDBKeyRange.bound($,I)),j=0;G.onsuccess=function(N){var z=N.target.result;if(!z)return D.seq=j,k();var Q=z.primaryKey;Q>j&&(j=Q),z.continue()}}function k(){var $=It(D,D.winningRev,D.deleted),I=o.put($);I.onsuccess=function(){_.continue()}}if(D.seq)return k();T()}}t._remote=!1,t.type=function(){return"idb"},t._id=Zn(function(p){p(null,t._meta.instanceId)}),t._bulkDocs=function(h,f,o){Gs(e,h,f,t,i,a(o))},t._get=function(h,f,o){var u,l,_,D=f.ctx;if(!D){var T=we(i,[se,fe,_e],"readonly");if(T.error)return o(T.error);D=T.txn}function k(){o(_,{doc:u,metadata:l,ctx:D})}D.objectStore(se).get(h).onsuccess=function($){if(l=Pe($.target.result),!l)return _=U(ve,"missing"),k();var I;if(f.rev)I=f.latest?Di(f.rev,l):f.rev;else{I=l.winningRev;var G=qe(l);if(G)return _=U(ve,"deleted"),k()}var j=D.objectStore(fe),N=l.id+"::"+I;j.index("_doc_id_rev").get(N).onsuccess=function(z){if(u=z.target.result,u&&(u=st(u)),!u)return _=U(ve,"missing"),k();k()}}},t._getAttachment=function(p,h,f,o,u){var l;if(o.ctx)l=o.ctx;else{var _=we(i,[se,fe,_e],"readonly");if(_.error)return u(_.error);l=_.txn}var D=f.digest,T=f.content_type;l.objectStore(_e).get(D).onsuccess=function(k){var $=k.target.result.body;Sr($,T,o.binary,function(I){u(null,I)})}},t._info=function(h){var f,o,u=we(i,[le,fe],"readonly");if(u.error)return h(u.error);var l=u.txn;l.objectStore(le).get(le).onsuccess=function(_){o=_.target.result.docCount},l.objectStore(fe).openKeyCursor(null,"prev").onsuccess=function(_){var D=_.target.result;f=D?D.key:0},l.oncomplete=function(){h(null,{doc_count:o,update_seq:f,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(h,f){Ws(h,i,a(f))},t._changes=function(h){return Zs(h,t,r,i)},t._close=function(p){i.close(),$e.delete(r),p()},t._getRevisionTree=function(p,h){var f=we(i,[se],"readonly");if(f.error)return h(f.error);var o=f.txn,u=o.objectStore(se).get(p);u.onsuccess=function(l){var _=Pe(l.target.result);_?h(null,_.rev_tree):h(U(ve))}},t._doCompaction=function(p,h,f){var o=[se,fe,_e,Te],u=we(i,o,"readwrite");if(u.error)return f(u.error);var l=u.txn,_=l.objectStore(se);_.get(p).onsuccess=function(D){var T=Pe(D.target.result);Be(T.rev_tree,function(I,G,j,N,z){var Q=G+"-"+j;h.indexOf(Q)!==-1&&(z.status="missing")}),Cr(h,p,l);var k=T.winningRev,$=T.deleted;l.objectStore(se).put(It(T,k,$))},l.onabort=Ae(f),l.oncomplete=function(){f()}},t._getLocal=function(p,h){var f=we(i,[Se],"readonly");if(f.error)return h(f.error);var o=f.txn,u=o.objectStore(Se).get(p);u.onerror=Ae(h),u.onsuccess=function(l){var _=l.target.result;_?(delete _._doc_id_rev,h(null,_)):h(U(ve))}},t._putLocal=function(p,h,f){typeof h=="function"&&(f=h,h={}),delete p._revisions;var o=p._rev,u=p._id;o?p._rev="0-"+(parseInt(o.split("-")[1],10)+1):p._rev="0-1";var l=h.ctx,_;if(!l){var D=we(i,[Se],"readwrite");if(D.error)return f(D.error);l=D.txn,l.onerror=Ae(f),l.oncomplete=function(){_&&f(null,_)}}var T=l.objectStore(Se),k;o?(k=T.get(u),k.onsuccess=function($){var I=$.target.result;if(!I||I._rev!==o)f(U(Me));else{var G=T.put(p);G.onsuccess=function(){_={ok:!0,id:p._id,rev:p._rev},h.ctx&&f(null,_)}}}):(k=T.add(p),k.onerror=function($){f(U(Me)),$.preventDefault(),$.stopPropagation()},k.onsuccess=function(){_={ok:!0,id:p._id,rev:p._rev},h.ctx&&f(null,_)})},t._removeLocal=function(p,h,f){typeof h=="function"&&(f=h,h={});var o=h.ctx;if(!o){var u=we(i,[Se],"readwrite");if(u.error)return f(u.error);o=u.txn,o.oncomplete=function(){l&&f(null,l)}}var l,_=p._id,D=o.objectStore(Se),T=D.get(_);T.onerror=Ae(f),T.onsuccess=function(k){var $=k.target.result;!$||$._rev!==p._rev?f(U(ve)):(D.delete(_),l={ok:!0,id:_,rev:"0-0"},h.ctx&&f(null,l))}},t._destroy=function(p,h){ze.removeAllListeners(r);var f=bt.get(r);f&&f.result&&(f.result.close(),$e.delete(r));var o=indexedDB.deleteDatabase(r);o.onsuccess=function(){bt.delete(r),nt()&&r in localStorage&&delete localStorage[r],h(null,{ok:!0})},o.onerror=Ae(h)};var S=$e.get(r);if(S)return i=S.idb,t._meta=S.global,Oe(function(){n(null,t)});var C=indexedDB.open(r,Fs);bt.set(r,C),C.onupgradeneeded=function(p){var h=p.target.result;if(p.oldVersion<1)return d(h);var f=p.currentTarget.transaction;p.oldVersion<3&&y(h),p.oldVersion<4&&c(h);var o=[v,m,g,w],u=p.oldVersion;function l(){var _=o[u-1];u++,_&&_(f,l)}l()},C.onsuccess=function(p){i=p.target.result,i.onversionchange=function(){i.close(),$e.delete(r)},i.onabort=function(k){ge("error","Database has a global failure",k.target.error),s=k.target.error,i.close(),$e.delete(r)};var h=i.transaction([le,mt,se],"readwrite"),f=!1,o,u,l,_;function D(){typeof l>"u"||!f||(t._meta={name:r,instanceId:_,blobSupport:l},$e.set(r,{idb:i,global:t._meta}),n(null,t))}function T(){if(!(typeof u>"u"||typeof o>"u")){var k=r+"_id";k in o?_=o[k]:o[k]=_=ft(),o.docCount=u,h.objectStore(le).put(o)}}h.objectStore(le).get(le).onsuccess=function(k){o=k.target.result||{id:le},T()},Hs(h,function(k){u=k,T()}),wt||(wt=ks(h,mt,"key")),wt.then(function(k){l=k,D()}),h.oncomplete=function(){f=!0,D()},h.onabort=Ae(n)},C.onerror=function(p){var h=p.target.error&&p.target.error.message;h?h.indexOf("stored database is a higher version")!==-1&&(h=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):h="Failed to open indexedDB, are you in private browsing mode?",ge("error",h),n(U(Ht,h))}}qr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function ea(t){t.adapter("idb",qr,!0)}function ta(t,e){return new Promise(function(n,r){var i=0,s=0,a=0,d=t.length,v;function y(){i++,t[s++]().then(c,g)}function m(){++a===d?v?r(v):n():w()}function c(){i--,m()}function g(S){i--,v=v||S,m()}function w(){for(;i<e&&s<d;)y()}w()})}const na=25,ra=50,Ye=5e3,ia=1e4,St={};function At(t){const e=t.doc||t.ok,n=e&&e._attachments;n&&Object.keys(n).forEach(function(r){const i=n[r];i.data=tn(i.data,i.content_type)})}function ke(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):t.startsWith("_local/")?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function On(t){return!t._attachments||!Object.keys(t._attachments)?Promise.resolve():Promise.all(Object.keys(t._attachments).map(function(e){const n=t._attachments[e];if(n.data&&typeof n.data!="string")return new Promise(function(r){nn(n.data,r)}).then(function(r){n.data=r})}))}function sa(t){if(!t.prefix)return!1;const e=rr(t.prefix).protocol;return e==="http"||e==="https"}function aa(t,e){if(sa(e)){const i=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}const n=rr(t);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});const r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ae(t,e){return tt(t,t.db+"/"+e)}function tt(t,e){const n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function Ze(t){const e=Object.keys(t);return e.length===0?"":"?"+e.map(n=>n+"="+encodeURIComponent(t[n])).join("&")}function oa(t){const e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=e.indexOf("msie")!==-1,r=e.indexOf("trident")!==-1,i=e.indexOf("edge")!==-1,s=!("method"in t)||t.method==="GET";return(n||r||i)&&s}function Kt(t,e){const n=this,r=aa(t.name,t),i=ae(r,"");t=oe(t);const s=async function(c,g){if(g=g||{},g.headers=g.headers||new Ke,g.credentials="include",t.auth||r.auth){const C=t.auth||r.auth,p=C.username+":"+C.password,h=He(unescape(encodeURIComponent(p)));g.headers.set("Authorization","Basic "+h)}const w=t.headers||{};return Object.keys(w).forEach(function(C){g.headers.append(C,w[C])}),oa(g)&&(c+=(c.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(t.fetch||vr)(c,g)};function a(c,g){return ne(c,function(...w){y().then(function(){return g.apply(this,w)}).catch(function(S){w.pop()(S)})}).bind(n)}async function d(c,g){const w={};g=g||{},g.headers=g.headers||new Ke,g.headers.get("Content-Type")||g.headers.set("Content-Type","application/json"),g.headers.get("Accept")||g.headers.set("Accept","application/json");const S=await s(c,g);w.ok=S.ok,w.status=S.status;const C=await S.json();if(w.data=C,!w.ok)throw w.data.status=w.status,Ue(w.data);return Array.isArray(w.data)&&(w.data=w.data.map(function(p){return p.error||p.missing?Ue(p):p})),w}let v;async function y(){return t.skip_setup?Promise.resolve():v||(v=d(i).catch(function(c){return c&&c.status&&c.status===404?(Dt(404,"PouchDB is just detecting if the remote exists."),d(i,{method:"PUT"})):Promise.reject(c)}).catch(function(c){return c&&c.status&&c.status===412?!0:Promise.reject(c)}),v.catch(function(){v=null}),v)}Oe(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=a("id",async function(c){let g;try{g=await(await s(tt(r,""))).json()}catch{g={}}const w=g&&g.uuid?g.uuid+r.db:ae(r,"");c(null,w)}),n.compact=a("compact",async function(c,g){typeof c=="function"&&(g=c,c={}),c=oe(c),await d(ae(r,"_compact"),{method:"POST"});function w(){n.info(function(S,C){C&&!C.compact_running?g(null,{ok:!0}):setTimeout(w,c.interval||200)})}w()}),n.bulkGet=ne("bulkGet",function(c,g){const w=this;async function S(f){const o={};c.revs&&(o.revs=!0),c.attachments&&(o.attachments=!0),c.latest&&(o.latest=!0);try{const u=await d(ae(r,"_bulk_get"+Ze(o)),{method:"POST",body:JSON.stringify({docs:c.docs})});c.attachments&&c.binary&&u.data.results.forEach(function(l){l.docs.forEach(At)}),f(null,u.data)}catch(u){f(u)}}function C(){const f=ra,o=Math.ceil(c.docs.length/f);let u=0;const l=new Array(o);function _(D){return function(T,k){l[D]=k.results,++u===o&&g(null,{results:l.flat()})}}for(let D=0;D<o;D++){const T=We(c,["revs","attachments","binary","latest"]);T.docs=c.docs.slice(D*f,Math.min(c.docs.length,(D+1)*f)),Vn(w,T,_(D))}}const p=tt(r,""),h=St[p];typeof h!="boolean"?S(function(f,o){f?(St[p]=!1,Dt(f.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),C()):(St[p]=!0,g(null,o))}):h?S(g):C()}),n._info=async function(c){try{await y();const w=await(await s(ae(r,""))).json();w.host=ae(r,""),c(null,w)}catch(g){c(g)}},n.fetch=async function(c,g){await y();const w=c.substring(0,1)==="/"?tt(r,c.substring(1)):ae(r,c);return s(w,g)},n.get=a("get",async function(c,g,w){typeof g=="function"&&(w=g,g={}),g=oe(g);const S={};g.revs&&(S.revs=!0),g.revs_info&&(S.revs_info=!0),g.latest&&(S.latest=!0),g.open_revs&&(g.open_revs!=="all"&&(g.open_revs=JSON.stringify(g.open_revs)),S.open_revs=g.open_revs),g.rev&&(S.rev=g.rev),g.conflicts&&(S.conflicts=g.conflicts),g.update_seq&&(S.update_seq=g.update_seq),c=ke(c);function C(f){const o=f._attachments,u=o&&Object.keys(o);if(!o||!u.length)return;async function l(D){const T=o[D],k=ke(f._id)+"/"+m(D)+"?rev="+f._rev,$=await s(ae(r,k));let I;"buffer"in $?I=await $.buffer():I=await $.blob();let G;if(g.binary){const j=Object.getOwnPropertyDescriptor(I.__proto__,"type");(!j||j.set)&&(I.type=T.content_type),G=I}else G=await new Promise(function(j){nn(I,j)});delete T.stub,delete T.length,T.data=G}const _=u.map(function(D){return function(){return l(D)}});return ta(_,5)}function p(f){return Array.isArray(f)?Promise.all(f.map(function(o){if(o.ok)return C(o.ok)})):C(f)}const h=ae(r,c+Ze(S));try{const f=await d(h);g.attachments&&await p(f.data),w(null,f.data)}catch(f){f.docId=c,w(f)}}),n.remove=a("remove",async function(c,g,w,S){let C;typeof g=="string"?(C={_id:c,_rev:g},typeof w=="function"&&(S=w,w={})):(C=c,typeof g=="function"?(S=g,w={}):(S=w,w=g));const p=C._rev||w.rev,h=ae(r,ke(C._id))+"?rev="+p;try{const f=await d(h,{method:"DELETE"});S(null,f.data)}catch(f){S(f)}});function m(c){return c.split("/").map(encodeURIComponent).join("/")}n.getAttachment=a("getAttachment",async function(c,g,w,S){typeof w=="function"&&(S=w,w={});const C=w.rev?"?rev="+w.rev:"",p=ae(r,ke(c))+"/"+m(g)+C;let h;try{const f=await s(p,{method:"GET"});if(!f.ok)throw f;h=f.headers.get("content-type");let o;if(typeof process<"u"&&!process.browser&&typeof f.buffer=="function"?o=await f.buffer():o=await f.blob(),typeof process<"u"&&!process.browser){const u=Object.getOwnPropertyDescriptor(o.__proto__,"type");(!u||u.set)&&(o.type=h)}S(null,o)}catch(f){S(f)}}),n.removeAttachment=a("removeAttachment",async function(c,g,w,S){const C=ae(r,ke(c)+"/"+m(g))+"?rev="+w;try{const p=await d(C,{method:"DELETE"});S(null,p.data)}catch(p){S(p)}}),n.putAttachment=a("putAttachment",async function(c,g,w,S,C,p){typeof C=="function"&&(p=C,C=S,S=w,w=null);const h=ke(c)+"/"+m(g);let f=ae(r,h);if(w&&(f+="?rev="+w),typeof S=="string"){let o;try{o=Zt(S)}catch{return p(U(tr,"Attachment is not a valid base64 string"))}S=o?en(o,C):""}try{const o=await d(f,{headers:new Ke({"Content-Type":C}),method:"PUT",body:S});p(null,o.data)}catch(o){p(o)}}),n._bulkDocs=async function(c,g,w){c.new_edits=g.new_edits;try{await y(),await Promise.all(c.docs.map(On));const S=await d(ae(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(c)});w(null,S.data)}catch(S){w(S)}},n._put=async function(c,g,w){try{await y(),await On(c);const S=await d(ae(r,ke(c._id)),{method:"PUT",body:JSON.stringify(c)});w(null,S.data)}catch(S){S.docId=c&&c._id,w(S)}},n.allDocs=a("allDocs",async function(c,g){typeof c=="function"&&(g=c,c={}),c=oe(c);const w={};let S,C="GET";c.conflicts&&(w.conflicts=!0),c.update_seq&&(w.update_seq=!0),c.descending&&(w.descending=!0),c.include_docs&&(w.include_docs=!0),c.attachments&&(w.attachments=!0),c.key&&(w.key=JSON.stringify(c.key)),c.start_key&&(c.startkey=c.start_key),c.startkey&&(w.startkey=JSON.stringify(c.startkey)),c.end_key&&(c.endkey=c.end_key),c.endkey&&(w.endkey=JSON.stringify(c.endkey)),typeof c.inclusive_end<"u"&&(w.inclusive_end=!!c.inclusive_end),typeof c.limit<"u"&&(w.limit=c.limit),typeof c.skip<"u"&&(w.skip=c.skip);const p=Ze(w);typeof c.keys<"u"&&(C="POST",S={keys:c.keys});try{const h=await d(ae(r,"_all_docs"+p),{method:C,body:JSON.stringify(S)});c.include_docs&&c.attachments&&c.binary&&h.data.rows.forEach(At),g(null,h.data)}catch(h){g(h)}}),n._changes=function(c){const g="batch_size"in c?c.batch_size:na;c=oe(c),c.continuous&&!("heartbeat"in c)&&(c.heartbeat=ia);let w="timeout"in c?c.timeout:30*1e3;"timeout"in c&&c.timeout&&w-c.timeout<Ye&&(w=c.timeout+Ye),"heartbeat"in c&&c.heartbeat&&w-c.heartbeat<Ye&&(w=c.heartbeat+Ye);const S={};"timeout"in c&&c.timeout&&(S.timeout=c.timeout);const C=typeof c.limit<"u"?c.limit:!1;let p=C;if(c.style&&(S.style=c.style),(c.include_docs||c.filter&&typeof c.filter=="function")&&(S.include_docs=!0),c.attachments&&(S.attachments=!0),c.continuous&&(S.feed="longpoll"),c.seq_interval&&(S.seq_interval=c.seq_interval),c.conflicts&&(S.conflicts=!0),c.descending&&(S.descending=!0),c.update_seq&&(S.update_seq=!0),"heartbeat"in c&&c.heartbeat&&(S.heartbeat=c.heartbeat),c.filter&&typeof c.filter=="string"&&(S.filter=c.filter),c.view&&typeof c.view=="string"&&(S.filter="_view",S.view=c.view),c.query_params&&typeof c.query_params=="object")for(const T in c.query_params)Object.prototype.hasOwnProperty.call(c.query_params,T)&&(S[T]=c.query_params[T]);let h="GET",f;c.doc_ids?(S.filter="_doc_ids",h="POST",f={doc_ids:c.doc_ids}):c.selector&&(S.filter="_selector",h="POST",f={selector:c.selector});const o=new AbortController;let u;const l=async function(T,k){if(c.aborted)return;S.since=T,typeof S.since=="object"&&(S.since=JSON.stringify(S.since)),c.descending?C&&(S.limit=p):S.limit=!C||p>g?g:p;const $=ae(r,"_changes"+Ze(S)),I={signal:o.signal,method:h,body:JSON.stringify(f)};if(u=T,!c.aborted)try{await y();const G=await d($,I);k(null,G.data)}catch(G){k(G)}},_={results:[]},D=function(T,k){if(c.aborted)return;let $=0;if(k&&k.results){$=k.results.length,_.last_seq=k.last_seq;let G=null,j=null;typeof k.pending=="number"&&(G=k.pending),(typeof _.last_seq=="string"||typeof _.last_seq=="number")&&(j=_.last_seq),c.query_params,k.results=k.results.filter(function(N){p--;const z=Xt(c)(N);return z&&(c.include_docs&&c.attachments&&c.binary&&At(N),c.return_docs&&_.results.push(N),c.onChange(N,G,j)),z})}else if(T){c.aborted=!0,c.complete(T);return}k&&k.last_seq&&(u=k.last_seq);const I=C&&p<=0||k&&$<g||c.descending;c.continuous&&!(C&&p<=0)||!I?Oe(function(){l(u,D)}):c.complete(null,_)};return l(c.since||0,D),{cancel:function(){c.aborted=!0,o.abort()}}},n.revsDiff=a("revsDiff",async function(c,g,w){typeof g=="function"&&(w=g,g={});try{const S=await d(ae(r,"_revs_diff"),{method:"POST",body:JSON.stringify(c)});w(null,S.data)}catch(S){w(S)}}),n._close=function(c){c()},n._destroy=async function(c,g){try{const w=await d(ae(r,""),{method:"DELETE"});g(null,w)}catch(w){w.status===404?g(null,{ok:!0}):g(w)}}}Kt.valid=function(){return!0};function ua(t){t.adapter("http",Kt,!1),t.adapter("https",Kt,!1)}class De extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,De)}catch{}}}class lt extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,lt)}catch{}}}class dt extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,dt)}catch{}}}function xr(t,e){return e&&t.then(function(n){Oe(function(){e(null,n)})},function(n){Oe(function(){e(n)})}),t}function ca(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return typeof n=="function"&&xr(r,n),r}}function fa(t,e){return t.then(function(n){return e().then(function(){return n})},function(n){return e().then(function(){throw n})})}function Ct(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function qn(t){var e=new Set(t),n=new Array(e.size),r=-1;return e.forEach(function(i){n[++r]=i}),n}function Ot(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,i){e[++n]=i}),e}function xn(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new dt(e)}function Ft(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];if(typeof i!="number")if(Array.isArray(i)){e=typeof e=="number"?[e]:e;for(var s=0,a=i.length;s<a;s++){var d=i[s];if(typeof d!="number")throw xn("_sum");typeof e[s]>"u"?e.push(d):e[s]+=d}}else throw xn("_sum");else typeof e=="number"?e+=i:e[0]+=i}return e}var la=ge.bind(null,"log"),da=Array.isArray,ha=JSON.parse;function Er(t,e){return Yt("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:Ft,log:la,isArray:da,toJSON:ha})}class Mt{constructor(){this.promise=Promise.resolve()}add(e){return this.promise=this.promise.catch(()=>{}).then(()=>e()),this.promise}finish(){return this.promise}}function En(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function va(t,e){return En(t)+En(e)+"undefined"}async function kn(t,e,n,r,i,s){const a=va(n,r);let d;if(!i&&(d=t._cachedViews=t._cachedViews||{},d[a]))return d[a];const v=t.info().then(async function(y){const m=y.db_name+"-mrview-"+(i?"temp":ar(a));function c(p){p.views=p.views||{};let h=e;h.indexOf("/")===-1&&(h=e+"/"+e);const f=p.views[h]=p.views[h]||{};if(!f[m])return f[m]=!0,p}await rt(t,"_local/"+s,c);const w=(await t.registerDependentDatabase(m)).db;w.auto_compaction=!0;const S={name:m,db:w,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r};let C;try{C=await S.db.get("_local/lastSeq")}catch(p){if(p.status!==404)throw p}return S.seq=C?C.seq:0,d&&S.db.once("destroyed",function(){delete d[a]}),S});return d&&(d[a]=v),v}const Dn={},Tn=new Mt,_a=50;function qt(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function ga(t){return t.length===1&&/^1-/.test(t[0].rev)}function Pn(t,e,n){try{t.emit("error",e)}catch{ge("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),ge("error",e,n)}}function ya(t,e,n,r){function i(b,A,E){try{A(E)}catch(q){Pn(b,q,{fun:A,doc:E})}}function s(b,A,E,q,P){try{return{output:A(E,q,P)}}catch(B){return Pn(b,B,{fun:A,keys:E,values:q,rereduce:P}),{error:B}}}function a(b,A){const E=re(b.key,A.key);return E!==0?E:re(b.value,A.value)}function d(b,A,E){return E=E||0,typeof A=="number"?b.slice(E,A+E):E>0?b.slice(E):b}function v(b){const A=b.value;return A&&typeof A=="object"&&A._id||b.id}function y(b){for(const A of b.rows){const E=A.doc&&A.doc._attachments;if(E)for(const q of Object.keys(E)){const P=E[q];E[q].data=tn(P.data,P.content_type)}}}function m(b){return function(A){return b.include_docs&&b.attachments&&b.binary&&y(A),A}}function c(b,A,E,q){let P=A[b];typeof P<"u"&&(q&&(P=encodeURIComponent(JSON.stringify(P))),E.push(b+"="+P))}function g(b){if(typeof b<"u"){const A=Number(b);return!isNaN(A)&&A===parseInt(b,10)?A:b}}function w(b){return b.group_level=g(b.group_level),b.limit=g(b.limit),b.skip=g(b.skip),b}function S(b){if(b){if(typeof b!="number")return new De(`Invalid value for integer: "${b}"`);if(b<0)return new De(`Invalid value for positive integer: "${b}"`)}}function C(b,A){const E=b.descending?"endkey":"startkey",q=b.descending?"startkey":"endkey";if(typeof b[E]<"u"&&typeof b[q]<"u"&&re(b[E],b[q])>0)throw new De("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(A.reduce&&b.reduce!==!1){if(b.include_docs)throw new De("{include_docs:true} is invalid for reduce");if(b.keys&&b.keys.length>1&&!b.group&&!b.group_level)throw new De("Multi-key fetches for reduce views must use {group: true}")}for(const P of["group_level","limit","skip"]){const B=S(b[P]);if(B)throw B}}async function p(b,A,E){let q=[],P,B="GET",M;if(c("reduce",E,q),c("include_docs",E,q),c("attachments",E,q),c("limit",E,q),c("descending",E,q),c("group",E,q),c("group_level",E,q),c("skip",E,q),c("stale",E,q),c("conflicts",E,q),c("startkey",E,q,!0),c("start_key",E,q,!0),c("endkey",E,q,!0),c("end_key",E,q,!0),c("inclusive_end",E,q),c("key",E,q,!0),c("update_seq",E,q),q=q.join("&"),q=q===""?"":"?"+q,typeof E.keys<"u"){const L=`keys=${encodeURIComponent(JSON.stringify(E.keys))}`;L.length+q.length+1<=2e3?q+=(q[0]==="?"?"&":"?")+L:(B="POST",typeof A=="string"?P={keys:E.keys}:A.keys=E.keys)}if(typeof A=="string"){const x=qt(A),L=await b.fetch("_design/"+x[0]+"/_view/"+x[1]+q,{headers:new Ke({"Content-Type":"application/json"}),method:B,body:JSON.stringify(P)});M=L.ok;const K=await L.json();if(!M)throw K.status=L.status,Ue(K);for(const F of K.rows)if(F.value&&F.value.error&&F.value.error==="builtin_reduce_error")throw new Error(F.reason);return new Promise(function(F){F(K)}).then(m(E))}P=P||{};for(const x of Object.keys(A))Array.isArray(A[x])?P[x]=A[x]:P[x]=A[x].toString();const R=await b.fetch("_temp_view"+q,{headers:new Ke({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(P)});M=R.ok;const O=await R.json();if(!M)throw O.status=R.status,Ue(O);return new Promise(function(x){x(O)}).then(m(E))}function h(b,A,E){return new Promise(function(q,P){b._query(A,E,function(B,M){if(B)return P(B);q(M)})})}function f(b){return new Promise(function(A,E){b._viewCleanup(function(q,P){if(q)return E(q);A(P)})})}function o(b){return function(A){if(A.status===404)return b;throw A}}async function u(b,A,E){const q="_local/doc_"+b,P={_id:q,keys:[]},B=E.get(b),M=B[0],R=B[1];function O(){return ga(R)?Promise.resolve(P):A.db.get(q).catch(o(P))}function x(Y){return Y.keys.length?A.db.allDocs({keys:Y.keys,include_docs:!0}):Promise.resolve({rows:[]})}function L(Y,te){const ie=[],de=new Set;for(const X of te.rows){const H=X.doc;if(H&&(ie.push(H),de.add(H._id),H._deleted=!M.has(H._id),!H._deleted)){const Z=M.get(H._id);"value"in Z&&(H.value=Z.value)}}const be=Ot(M);for(const X of be)if(!de.has(X)){const H={_id:X},Z=M.get(X);"value"in Z&&(H.value=Z.value),ie.push(H)}return Y.keys=qn(be.concat(Y.keys)),ie.push(Y),ie}const K=await O(),F=await x(K);return L(K,F)}function l(b){return b.sourceDB.get("_local/purges").then(function(A){const E=A.purgeSeq;return b.db.get("_local/purgeSeq").then(function(q){return q._rev}).catch(o(void 0)).then(function(q){return b.db.put({_id:"_local/purgeSeq",_rev:q,purgeSeq:E})})}).catch(function(A){if(A.status!==404)throw A})}function _(b,A,E){var q="_local/lastSeq";return b.db.get(q).catch(o({_id:q,seq:0})).then(function(P){var B=Ot(A);return Promise.all(B.map(function(M){return u(M,b,A)})).then(function(M){var R=M.flat();return P.seq=E,R.push(P),b.db.bulkDocs({docs:R})}).then(()=>l(b))})}function D(b){const A=typeof b=="string"?b:b.name;let E=Dn[A];return E||(E=Dn[A]=new Mt),E}async function T(b,A){return Ct(D(b),function(){return k(b,A)})()}async function k(b,A){let E,q,P;function B(X,H){const Z={id:q._id,key:Ie(X)};typeof H<"u"&&H!==null&&(Z.value=Ie(H)),E.push(Z)}const M=e(b.mapFun,B);let R=b.seq||0;function O(){return b.sourceDB.info().then(function(X){P=b.sourceDB.activeTasks.add({name:"view_indexing",total_items:X.update_seq-R})})}function x(X,H){return function(){return _(b,X,H)}}let L=0;const K={view:b.name,indexed_docs:L};b.sourceDB.emit("indexing",K);const F=new Mt;async function Y(){const X=await b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:R,limit:A.changes_batch_size}),H=await te();return ie(X,H)}function te(){return b.db.get("_local/purgeSeq").then(function(X){return X.purgeSeq}).catch(o(-1)).then(function(X){return b.sourceDB.get("_local/purges").then(function(H){const Z=H.purges.filter(function(he,ue){return ue>X}).map(he=>he.docId),ye=Z.filter(function(he,ue){return Z.indexOf(he)===ue});return Promise.all(ye.map(function(he){return b.sourceDB.get(he).then(function(ue){return{docId:he,doc:ue}}).catch(o({docId:he}))}))}).catch(o([]))})}function ie(X,H){const Z=X.results;if(!Z.length&&!H.length)return;for(const ue of H)if(Z.findIndex(function(Ge){return Ge.id===ue.docId})<0){const Ge={_id:ue.docId,doc:{_id:ue.docId,_deleted:1},changes:[]};ue.doc&&(Ge.doc=ue.doc,Ge.changes.push({rev:ue.doc._rev})),Z.push(Ge)}const ye=de(Z);F.add(x(ye,R)),L=L+Z.length;const he={view:b.name,last_seq:X.last_seq,results_count:Z.length,indexed_docs:L};if(b.sourceDB.emit("indexing",he),b.sourceDB.activeTasks.update(P,{completed_items:L}),!(Z.length<A.changes_batch_size))return Y()}function de(X){const H=new Map;for(const Z of X){if(Z.doc._id[0]!=="_"){E=[],q=Z.doc,q._deleted||i(b.sourceDB,M,q),E.sort(a);const ye=be(E);H.set(Z.doc._id,[ye,Z.changes])}R=Z.seq}return H}function be(X){const H=new Map;let Z;for(let ye=0,he=X.length;ye<he;ye++){const ue=X[ye],ht=[ue.key,ue.id];ye>0&&re(ue.key,Z)===0&&ht.push(ye),H.set(me(ht),ue),Z=ue.key}return H}try{await O(),await Y(),await F.finish(),b.seq=R,b.sourceDB.activeTasks.remove(P)}catch(X){b.sourceDB.activeTasks.remove(P,X)}}function $(b,A,E){E.group_level===0&&delete E.group_level;const q=E.group||E.group_level,P=n(b.reduceFun),B=[],M=isNaN(E.group_level)?Number.POSITIVE_INFINITY:E.group_level;for(const R of A){const O=B[B.length-1];let x=q?R.key:null;if(q&&Array.isArray(x)&&(x=x.slice(0,M)),O&&re(O.groupKey,x)===0){O.keys.push([R.key,R.id]),O.values.push(R.value);continue}B.push({keys:[[R.key,R.id]],values:[R.value],groupKey:x})}A=[];for(const R of B){const O=s(b.sourceDB,P,R.keys,R.values,!1);if(O.error&&O.error instanceof dt)throw O.error;A.push({value:O.error?null:O.output,key:R.groupKey})}return{rows:d(A,E.limit,E.skip)}}function I(b,A){return Ct(D(b),function(){return G(b,A)})()}async function G(b,A){let E;const q=b.reduceFun&&A.reduce!==!1,P=A.skip||0;typeof A.keys<"u"&&!A.keys.length&&(A.limit=0,delete A.keys);async function B(R){R.include_docs=!0;const O=await b.db.allDocs(R);return E=O.total_rows,O.rows.map(function(x){if("value"in x.doc&&typeof x.doc.value=="object"&&x.doc.value!==null){const K=Object.keys(x.doc.value).sort(),F=["id","key","value"];if(!(K<F||K>F))return x.doc.value}const L=us(x.doc._id);return{key:L[0],id:L[1],value:"value"in x.doc?x.doc.value:null}})}async function M(R){let O;if(q?O=$(b,R,A):typeof A.keys>"u"?O={total_rows:E,offset:P,rows:R}:O={total_rows:E,offset:P,rows:d(R,A.limit,A.skip)},A.update_seq&&(O.update_seq=b.seq),A.include_docs){const x=qn(R.map(v)),L=await b.sourceDB.allDocs({keys:x,include_docs:!0,conflicts:A.conflicts,attachments:A.attachments,binary:A.binary}),K=new Map;for(const F of L.rows)K.set(F.id,F.doc);for(const F of R){const Y=v(F),te=K.get(Y);te&&(F.doc=te)}}return O}if(typeof A.keys<"u"){const O=A.keys.map(function(K){const F={startkey:me([K]),endkey:me([K,{}])};return A.update_seq&&(F.update_seq=!0),B(F)}),L=(await Promise.all(O)).flat();return M(L)}else{const R={descending:A.descending};A.update_seq&&(R.update_seq=!0);let O,x;if("start_key"in A&&(O=A.start_key),"startkey"in A&&(O=A.startkey),"end_key"in A&&(x=A.end_key),"endkey"in A&&(x=A.endkey),typeof O<"u"&&(R.startkey=A.descending?me([O,{}]):me([O])),typeof x<"u"){let K=A.inclusive_end!==!1;A.descending&&(K=!K),R.endkey=me(K?[x,{}]:[x])}if(typeof A.key<"u"){const K=me([A.key]),F=me([A.key,{}]);R.descending?(R.endkey=K,R.startkey=F):(R.startkey=K,R.endkey=F)}q||(typeof A.limit=="number"&&(R.limit=A.limit),R.skip=P);const L=await B(R);return M(L)}}async function j(b){return(await b.fetch("_view_cleanup",{headers:new Ke({"Content-Type":"application/json"}),method:"POST"})).json()}async function N(b){try{const A=await b.get("_local/"+t),E=new Map;for(const O of Object.keys(A.views)){const x=qt(O),L="_design/"+x[0],K=x[1];let F=E.get(L);F||(F=new Set,E.set(L,F)),F.add(K)}const q={keys:Ot(E),include_docs:!0},P=await b.allDocs(q),B={};for(const O of P.rows){const x=O.key.substring(8);for(const L of E.get(O.key)){let K=x+"/"+L;A.views[K]||(K=L);const F=Object.keys(A.views[K]),Y=O.doc&&O.doc.views&&O.doc.views[L];for(const te of F)B[te]=B[te]||Y}}const R=Object.keys(B).filter(function(O){return!B[O]}).map(function(O){return Ct(D(O),function(){return new b.constructor(O,b.__opts).destroy()})()});return Promise.all(R).then(function(){return{ok:!0}})}catch(A){if(A.status===404)return{ok:!0};throw A}}async function z(b,A,E){if(typeof b._query=="function")return h(b,A,E);if(Ce(b))return p(b,A,E);const q={changes_batch_size:b.__opts.view_update_changes_batch_size||_a};if(typeof A!="string")return C(E,A),Tn.add(async function(){const P=await kn(b,"temp_view/temp_view",A.map,A.reduce,!0,t);return fa(T(P,q).then(function(){return I(P,E)}),function(){return P.db.destroy()})}),Tn.finish();{const P=A,B=qt(P),M=B[0],R=B[1],O=await b.get("_design/"+M);if(A=O.views&&O.views[R],!A)throw new lt(`ddoc ${O._id} has no view named ${R}`);r(O,R),C(E,A);const x=await kn(b,P,A.map,A.reduce,!1,t);return E.stale==="ok"||E.stale==="update_after"?(E.stale==="update_after"&&Oe(function(){T(x,q)}),I(x,E)):(await T(x,q),I(x,E))}}function Q(b,A,E){const q=this;typeof A=="function"&&(E=A,A={}),A=A?w(A):{},typeof b=="function"&&(b={map:b});const P=Promise.resolve().then(function(){return z(q,b,A)});return xr(P,E),P}const W=ca(function(){const b=this;return typeof b._viewCleanup=="function"?f(b):Ce(b)?j(b):N(b)});return{query:Q,viewCleanup:W}}var xt={_sum:function(t,e){return Ft(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(r){for(var i=0,s=0,a=r.length;s<a;s++){var d=r[s];i+=d*d}return i}return{sum:Ft(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}};function pa(t){if(/^_sum/.test(t))return xt._sum;if(/^_count/.test(t))return xt._count;if(/^_stats/.test(t))return xt._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}function ma(t,e){if(typeof t=="function"&&t.length===2){var n=t;return function(r){return n(r,e)}}else return Er(t.toString(),e)}function wa(t){var e=t.toString(),n=pa(e);return n||Er(e)}function ba(t,e){var n=t.views&&t.views[e];if(typeof n.map!="string")throw new lt("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}var Sa="mrviews",kr=ya(Sa,ma,wa,ba);function Aa(t,e,n){return kr.query.call(this,t,e,n)}function Ca(t){return kr.viewCleanup.call(this,t)}var Oa={query:Aa,viewCleanup:Ca};function qa(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function Rn(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(r){return t.getAttachment(e._id,r,{rev:e._rev})}))}function xa(t,e,n){var r=Ce(e)&&!Ce(t),i=Object.keys(n._attachments);return r?t.get(n._id).then(function(s){return Promise.all(i.map(function(a){return qa(s,n,a)?e.getAttachment(n._id,a):t.getAttachment(s._id,a)}))}).catch(function(s){if(s.status!==404)throw s;return Rn(e,n)}):Rn(e,n)}function Ea(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(i){e.push({id:n,rev:i})})}),{docs:e,revs:!0,latest:!0}}function ka(t,e,n,r){n=oe(n);var i=[],s=!0;function a(){var v=Ea(n);if(v.docs.length)return t.bulkGet(v).then(function(y){if(r.cancelled)throw new Error("cancelled");return Promise.all(y.results.map(function(m){return Promise.all(m.docs.map(function(c){var g=c.ok;return c.error&&(s=!1),!g||!g._attachments?g:xa(e,t,g).then(w=>{var S=Object.keys(g._attachments);return w.forEach(function(C,p){var h=g._attachments[S[p]];delete h.stub,delete h.length,h.data=C}),g})}))})).then(function(m){i=i.concat(m.flat().filter(Boolean))})})}function d(){return{ok:s,docs:i}}return Promise.resolve().then(a).then(d)}var Ln=1,Bn="pouchdb",Da=5,pe=0;function Ut(t,e,n,r,i){return t.get(e).catch(function(s){if(s.status===404)return(t.adapter==="http"||t.adapter==="https")&&Dt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:Bn,version:Ln};throw s}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(a){return a.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,Da),s.version=Ln,s.replicator=Bn,s.session_id=r,s.last_seq=n,t.put(s).catch(function(a){if(a.status===409)return Ut(t,e,n,r,i);throw a})})}class In{constructor(e,n,r,i,s={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=e,this.target=n,this.id=r,this.returnValue=i,this.opts=s,typeof s.writeSourceCheckpoint>"u"&&(s.writeSourceCheckpoint=!0),typeof s.writeTargetCheckpoint>"u"&&(s.writeTargetCheckpoint=!0)}writeCheckpoint(e,n){var r=this;return this.updateTarget(e,n).then(function(){return r.updateSource(e,n)})}updateTarget(e,n){return this.opts.writeTargetCheckpoint?Ut(this.target,this.id,e,n,this.returnValue):Promise.resolve(!0)}updateSource(e,n){if(this.opts.writeSourceCheckpoint){var r=this;return Ut(this.src,this.id,e,n,this.returnValue).catch(function(i){if($n(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var e=this;return!e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?Promise.resolve(pe):e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(n){return n.last_seq||pe}).catch(function(n){if(n.status!==404)throw n;return pe}):e.target.get(e.id).then(function(n){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?n.last_seq||pe:e.src.get(e.id).then(function(r){if(n.version!==r.version)return pe;var i;return n.version?i=n.version.toString():i="undefined",i in jn?jn[i](n,r):pe},function(r){if(r.status===404&&n.last_seq)return e.src.put({_id:e.id,last_seq:pe}).then(function(){return pe},function(i){return $n(i)?(e.opts.writeSourceCheckpoint=!1,n.last_seq):pe});throw r})}).catch(function(n){if(n.status!==404)throw n;return pe})}}var jn={undefined:function(t,e){return re(t.last_seq,e.last_seq)===0?e.last_seq:0},1:function(t,e){return Ta(e,t).last_seq}};function Ta(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:Dr(t.history,e.history)}function Dr(t,e){var n=t[0],r=t.slice(1),i=e[0],s=e.slice(1);if(!n||e.length===0)return{last_seq:pe,history:[]};var a=n.session_id;if(Gt(a,e))return{last_seq:n.last_seq,history:t};var d=i.session_id;return Gt(d,r)?{last_seq:i.last_seq,history:s}:Dr(r,s)}function Gt(t,e){var n=e[0],r=e.slice(1);return!t||e.length===0?!1:t===n.session_id?!0:Gt(t,r)}function $n(t){return typeof t.status=="number"&&Math.floor(t.status/100)===4}function Tr(t,e,n,r,i){return this instanceof In?Tr:new In(t,e,n,r,i)}var Nn=0;function Pa(t,e,n,r){if(t.retry===!1){e.emit("error",n),e.removeAllListeners();return}if(typeof t.back_off_function!="function"&&(t.back_off_function=ti),e.emit("requestError",n),e.state==="active"||e.state==="pending"){e.emit("paused",n),e.state="stopped";var i=function(){t.current_back_off=Nn},s=function(){e.removeListener("active",i)};e.once("paused",s),e.once("active",i)}t.current_back_off=t.current_back_off||Nn,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function Ra(t){return Object.keys(t).sort(re).reduce(function(e,n){return e[n]=t[n],e},{})}function La(t,e,n){var r=n.doc_ids?n.doc_ids.sort(re):"",i=n.filter?n.filter.toString():"",s="",a="",d="";return n.selector&&(d=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(Ra(n.query_params))),n.filter&&n.filter==="_view"&&(a=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(v){var y=v[0]+v[1]+i+a+s+r+d;return new Promise(function(m){rn(y,m)})}).then(function(v){return v=v.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+v})}function Pr(t,e,n,r,i){var s=[],a,d={seq:0,changes:[],docs:[]},v=!1,y=!1,m=!1,c=0,g=0,w=n.continuous||n.live||!1,S=n.batch_size||100,C=n.batches_limit||10,p=n.style||"all_docs",h=!1,f=n.doc_ids,o=n.selector,u,l,_=[],D=ft(),T;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var k={};r.ready(t,e);function $(){return l?Promise.resolve():La(t,e,n).then(function(O){u=O;var x={};n.checkpoint===!1?x={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?x={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?x={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:x={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},l=new Tr(t,e,u,r,x)})}function I(){if(_=[],a.docs.length!==0){var O=a.docs,x={timeout:n.timeout};return e.bulkDocs({docs:O,new_edits:!1},x).then(function(L){if(r.cancelled)throw b(),new Error("cancelled");var K=Object.create(null);L.forEach(function(Y){Y.error&&(K[Y.id]=Y)});var F=Object.keys(K).length;i.doc_write_failures+=F,i.docs_written+=O.length-F,O.forEach(function(Y){var te=K[Y._id];if(te){i.errors.push(te);var ie=(te.name||"").toLowerCase();if(ie==="unauthorized"||ie==="forbidden")r.emit("denied",oe(te));else throw te}else _.push(Y)})},function(L){throw i.doc_write_failures+=O.length,L})}}function G(){if(a.error)throw new Error("There was a problem getting docs.");i.last_seq=g=a.seq;var O=oe(i);return _.length&&(O.docs=_,typeof a.pending=="number"&&(O.pending=a.pending,delete a.pending),r.emit("change",O)),v=!0,t.info().then(function(x){var L=t.activeTasks.get(T);if(!(!a||!L)){var K=L.completed_items||0,F=parseInt(x.update_seq,10)-parseInt(c,10);t.activeTasks.update(T,{completed_items:K+a.changes.length,total_items:F})}}),l.writeCheckpoint(a.seq,D).then(function(){if(r.emit("checkpoint",{checkpoint:a.seq}),v=!1,r.cancelled)throw b(),new Error("cancelled");a=void 0,P()}).catch(function(x){throw R(x),x})}function j(){var O={};return a.changes.forEach(function(x){r.emit("checkpoint",{revs_diff:x}),x.id!=="_user/"&&(O[x.id]=x.changes.map(function(L){return L.rev}))}),e.revsDiff(O).then(function(x){if(r.cancelled)throw b(),new Error("cancelled");a.diffs=x})}function N(){return ka(t,e,a.diffs,r).then(function(O){a.error=!O.ok,O.docs.forEach(function(x){delete a.diffs[x._id],i.docs_read++,a.docs.push(x)})})}function z(){if(!(r.cancelled||a)){if(s.length===0){Q(!0);return}a=s.shift(),r.emit("checkpoint",{start_next_batch:a.seq}),j().then(N).then(I).then(G).then(z).catch(function(O){W("batch processing terminated with error",O)})}}function Q(O){if(d.changes.length===0){s.length===0&&!a&&((w&&k.live||y)&&(r.state="pending",r.emit("paused")),y&&b());return}(O||y||d.changes.length>=S)&&(s.push(d),d={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function W(O,x){m||(x.message||(x.message=O),i.ok=!1,i.status="aborting",s=[],d={seq:0,changes:[],docs:[]},b(x))}function b(O){if(!m&&!(r.cancelled&&(i.status="cancelled",v)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=g,m=!0,t.activeTasks.remove(T,O),O){O=U(O),O.result=i;var x=(O.name||"").toLowerCase();x==="unauthorized"||x==="forbidden"?(r.emit("error",O),r.removeAllListeners()):Pa(n,r,O,function(){Pr(t,e,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function A(O,x,L){if(r.cancelled)return b();typeof x=="number"&&(d.pending=x);var K=Xt(n)(O);if(!K){var F=t.activeTasks.get(T);if(F){var Y=F.completed_items||0;t.activeTasks.update(T,{completed_items:++Y})}return}d.seq=O.seq||L,d.changes.push(O),r.emit("checkpoint",{pending_batch:d.seq}),Oe(function(){Q(s.length===0&&k.live)})}function E(O){if(h=!1,r.cancelled)return b();if(O.results.length>0)k.since=O.results[O.results.length-1].seq,P(),Q(!0);else{var x=function(){w?(k.live=!0,P()):y=!0,Q(!0)};!a&&O.results.length===0?(v=!0,l.writeCheckpoint(O.last_seq,D).then(function(){if(v=!1,i.last_seq=g=O.last_seq,r.cancelled)throw b(),new Error("cancelled");x()}).catch(R)):x()}}function q(O){if(h=!1,r.cancelled)return b();W("changes rejected",O)}function P(){if(!(!h&&!y&&s.length<C))return;h=!0;function O(){L.cancel()}function x(){r.removeListener("cancel",O)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",O);var L=t.changes(k).on("change",A);L.then(x,x),L.then(E).catch(q),n.retry&&(r._changes=L,r._abortChanges=O)}function B(O){return t.info().then(function(x){var L=typeof n.since>"u"?parseInt(x.update_seq,10)-parseInt(O,10):parseInt(x.update_seq,10);return T=t.activeTasks.add({name:`${w?"continuous ":""}replication from ${x.db_name}`,total_items:L}),O})}function M(){$().then(function(){if(r.cancelled){b();return}return l.getCheckpoint().then(B).then(function(O){g=O,c=O,k={since:g,limit:S,batch_size:S,style:p,doc_ids:f,selector:o,return_docs:!0},n.filter&&(typeof n.filter!="string"?k.include_docs=!0:k.filter=n.filter),"heartbeat"in n&&(k.heartbeat=n.heartbeat),"timeout"in n&&(k.timeout=n.timeout),n.query_params&&(k.query_params=n.query_params),n.view&&(k.view=n.view),P()})}).catch(function(O){W("getCheckpoint rejected with ",O)})}function R(O){v=!1,W("writeCheckpoint completed with error",O)}if(r.cancelled){b();return}r._addedListeners||(r.once("cancel",b),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(O){n.complete(null,O)})),r._addedListeners=!0),typeof n.since>"u"?M():$().then(function(){return v=!0,l.writeCheckpoint(n.since,D)}).then(function(){if(v=!1,r.cancelled){b();return}g=n.since,M()}).catch(R)}class Ba extends xe{constructor(){super(),this.cancelled=!1,this.state="pending";const e=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return e.then(n,r)},this.catch=function(n){return e.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(e,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};e.once("destroyed",r),n.once("destroyed",r);function i(){e.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function at(t,e){var n=e.PouchConstructor;return typeof t=="string"?new n(t,e):t}function Jt(t,e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw U(ct,"`doc_ids` filter parameter is not a list.");n.complete=r,n=oe(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new Ba(n),s=at(t,n),a=at(e,n);return Pr(s,a,n,i),i}function Ia(t,e,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=oe(n),n.PouchConstructor=n.PouchConstructor||this,t=at(t,n),e=at(e,n),new ja(t,e,n,r)}class ja extends xe{constructor(e,n,r,i){super(),this.canceled=!1;const s=r.push?Object.assign({},r,r.push):r,a=r.pull?Object.assign({},r,r.pull):r;this.push=Jt(e,n,s),this.pull=Jt(n,e,a),this.pushPaused=!0,this.pullPaused=!0;const d=o=>{this.emit("change",{direction:"pull",change:o})},v=o=>{this.emit("change",{direction:"push",change:o})},y=o=>{this.emit("denied",{direction:"push",doc:o})},m=o=>{this.emit("denied",{direction:"pull",doc:o})},c=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},g=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},w=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},S=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let C={};const p=o=>(u,l)=>{(u==="change"&&(l===d||l===v)||u==="denied"&&(l===m||l===y)||u==="paused"&&(l===g||l===c)||u==="active"&&(l===S||l===w))&&(u in C||(C[u]={}),C[u][o]=!0,Object.keys(C[u]).length===2&&this.removeAllListeners(u))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function h(o,u,l){o.listeners(u).indexOf(l)==-1&&o.on(u,l)}this.on("newListener",function(o){o==="change"?(h(this.pull,"change",d),h(this.push,"change",v)):o==="denied"?(h(this.pull,"denied",m),h(this.push,"denied",y)):o==="active"?(h(this.pull,"active",S),h(this.push,"active",w)):o==="paused"&&(h(this.pull,"paused",g),h(this.push,"paused",c))}),this.on("removeListener",function(o){o==="change"?(this.pull.removeListener("change",d),this.push.removeListener("change",v)):o==="denied"?(this.pull.removeListener("denied",m),this.push.removeListener("denied",y)):o==="active"?(this.pull.removeListener("active",S),this.push.removeListener("active",w)):o==="paused"&&(this.pull.removeListener("paused",g),this.push.removeListener("paused",c))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));const f=Promise.all([this.push,this.pull]).then(o=>{const u={push:o[0],pull:o[1]};return this.emit("complete",u),i&&i(null,u),this.removeAllListeners(),u},o=>{if(this.cancel(),i?i(o):this.emit("error",o),this.removeAllListeners(),i)throw o});this.then=function(o,u){return f.then(o,u)},this.catch=function(o){return f.catch(o)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function $a(t){t.replicate=Jt,t.sync=Ia,Object.defineProperty(t.prototype,"replicate",{get:function(){var e=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return e.constructor.replicate(n,e,r,i)},to:function(n,r,i){return e.constructor.replicate(e,n,r,i)}}),this.replicateMethods}}),t.prototype.sync=function(e,n,r){return this.constructor.sync(this,e,n,r)}}J.plugin(ea).plugin(ua).plugin(Oa).plugin($a);export{J as default};
